<!--
receipt1.html - Audit generic receipt
Copyright (C) 2004 R. James Holton

This program is free software; you can redistribute it and/or modify it 
under the terms of the GNU General Public License as published by the 
Free Software Foundation; either version 2 of the License, or (at your option) 
any later version.  This program is distributed in the hope that it will be 
useful, but WITHOUT ANY WARRANTY; without even the implied warranty of 
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU General 
Public License for more details.

You should have received a copy of the GNU General Public License along with 
this program; if not, write to the Free Software Foundation, Inc., 
675 Mass Ave, Cambridge, MA 02139, USA. 
-->
<html>

<head>
<title>Generic Audit Receipt</title>
<link rel="stylesheet" href="../expense.css" type="text/css"></head>

<body onLoad="Javascript: void initForm(); FillForm()">

<table border="0" width="100%" cellpadding="0" cellspacing="0" class="offsetColor">
  <tr>
    <td width="50%"><em><div class="ExpenseTag"><big><big><span id="receiptMaj">Receipt</span>:</big></big></div></em></td>
  </tr>
</table>

<form>
  <input type="hidden" name="RCPTTYPE" value>
  <input type="hidden" name="VOUCHER" value>
  <input type="hidden" name="RECEIPT" value>
  <input type="hidden" name="XRATE" value>
  <input type="hidden" name="XDATE" value>
  <input type="hidden" name="RATETYPE" value>
  <input type="hidden" name="XSOURCE" value>
  <input type="hidden" name="CRE_DATE" value>
  <input type="hidden" name="persistance">
  <input type="hidden" name="expense_1_attendeelist" value="[]" subtype="nosave">
  <input type="hidden" name="expense_1_persplit" value subtype="nosave">
  <input type="hidden" name="expense_1_persistance" value subtype="nosave">
  <input type="hidden" name="expense_1_credate" value subtype="nosave">
  
  <table border="0" width="100%" cellpadding="0" cellspacing="0">
    <tr>
      <td width="10%"><div class="ExpenseTag"><span id="refer">Reference</span>:</div></td>
      <td width="50%"><input type="text" name="REFER" readonly="yes" size="12" tabindex="1"></td>
      <td width="10%"><div class="ExpenseTag"><span id="receiptInt">Receipt?</span>:</div></td>
      <td width="50%"><input type="text" name="CHECK" readonly="yes" size="8" tabindex="13"></td>
    </tr>
    <tr>
      <td width="10%" class="offsetColor"><div class="ExpenseTag"><span id="receiptDate">Receipt Date</span>:</div></td>
      <td width="50%" class="offsetColor"><input type="text" name="REC_DATE" readonly="yes" size="13" tabindex="1"></td>
      <td width="10%" class="offsetColor"><div class="ExpenseTag"><span id="currency">Currency</span>:</div></td>
      <td width="50%" class="offsetColor"><input type="text" name="UNITS" readonly="yes" size="16" readOnly="yes"></td>
    </tr>
    <tr>
      <td width="20%"><div class="ExpenseTag"><script>document.write(parent.contents.getReportCurrencyLabel())</script>:</div></td>
      <td width="50%"><input type="text" name="AMOUNT" readonly="yes" size="12" value="0.00" tabindex="4"></td>
      <td width="20%"><div class="ExpenseTag"><span class="foreignAmo">Foreign Amount</span>:</div></td>
      <td width="50%"><input type="text" name="REC_AMT" readonly="yes" size="9" value tabindex="5"></td>
    </tr>
    <tr>
      <td width="20%" class="offsetColor"><div class="ExpenseTag"><span id="paidBy">Paid By</span>:</div></td>
      <td width="50%" class="offsetColor"><input type="text" name="CHARGE" readonly="yes" size="16" tabindex="12">
      </td>
      <td width="20%" class="offsetColor"><div class="ExpenseTag"><span id="merchant">Merchant</span>:</div></td>
      <td width="50%" class="offsetColor"><input type="text" name="MERCHANT" readonly="yes" size="16" tabindex="7"></td>
    </tr>
   <tr>
      <td width="20%"><div class="ExpenseTag"><span id="checkingDat">Checkin Date</span>:</div></td>
      <td width="50%"><input type="text" name="BEG_DATE" size="13"><a HREF="javascript:doNothing()" onClick="setDateField(document.forms[0].BEG_DATE)"><img SRC="../calendar.gif" BORDER="0" WIDTH="16" HEIGHT="16"></a>
      <span class="ExpenseTag">&nbsp;(<span class="lodgingOnl">lodging only</span>)</span></td>
       <td width="20%"><div class="ExpenseTag"><span id="okref">Prepop Reference</span>:</div></td>
      <td width="50%"><input type="text" name="OK_REF" size="8"> </td>
   </tr>
    <tr class="offsetColor">
      <td width="20%"><div class="ExpenseTag"><span id="location">Location</span>:</div></td>
      <td width="50%"><select name="LOCATION" size="1" mysubst="9">
          </select> <!--<a class="ExpenseLink" href="javascript:doNothing()" mysubst="11" onClick="setLocalObj(document.forms[0].LOCATION);MerchantType = 'location'"><span id="newLocation">New Location</span></a>-->
      </td>
      <td width="20%"></td>
      <td width="50%"></td>
     </tr>
    
  </table>
  <table border="0" width="100%" cellpadding="0" cellspacing="0">
    <tr>
      <td width="25%"></td>
      <td width="50%"><div class="ExpenseTag"><span id="expenseAccLis">Expense Accounting List</span></div></td>
      <td width="25%"></td>
    </tr>
  </table>
  <table border="0" width="100%" cellpadding="0" cellspacing="0">
    <tr>
      <td width="20%" class="offsetColor" align="right"><div class="ExpenseTag"><span id="expenses">Expenses</span>:&nbsp;</div></td>
      <td width="50%" class="offsetColor" height="26" align="center">
      <select name="displaylist" size="1" tabindex="2" width="40" subtype="list" onChange="loadExpense()">
      </select></td>
      <td width="20%" class="offsetColor" align="center"><div class="ExpenseTag"></div></td>
      <td width="50%" class="offsetColor"></td>
    </tr>
    <tr>
      <td width="20%"></td>
      <td width="50%"></td>
      <td width="20%"><div class="ExpenseTag"><span id="remainingDis">Remaining to disburse</span>:</div></td>
      <td width="50%"><input type="text" name="expense_1_disburse" readonly="yes" size="9" value tabindex="5" readOnly="yes" subtype="nosave"></td>
    </tr>
    <tr>
      <td width="20%" class="offsetColor"><div class="ExpenseTag"><span id="expdate">Expense Date</span>:</div></td>
      <td width="50%" class="offsetColor"><input type="text" name="expense_1_expdate" readonly="yes" size="13" tabindex="1" subtype="nosave"></td>
      <td width="20%" class="offsetColor"></td>
      <td width="50%" class="offsetColor"></td>
    </tr>
    <tr>
      <td width="20%"><div class="ExpenseTag"><span id="expenseType">Expense Type</span>: </div></td>
      <td width="50%"><input type="text" name="expense_1_expensetype" readonly="yes" size="20" tabindex="6" subtype="nosave">
      </select></td>
      <td width="20%"></td>
      <td width="50%"></td>
    </tr>
    <tr>
      <td width="20%" class="offsetColor"><div class="ExpenseTag"><script>document.write(parent.contents.getReportCurrencyLabel())</script>:</div></td>
      <td width="50%" class="offsetColor"><input type="text" name="expense_1_amount" readonly="yes" size="12" value="0.00" tabindex="4" subtype="nosave"></td>
      <td width="20%" class="offsetColor"><div class="ExpenseTag"><span class="foreignAmo">Foreign Amount</span>:</div></td>
      <td width="50%" class="offsetColor"><input type="text" name="expense_1_rec_amt" readonly="yes" size="9" value tabindex="5" readOnly="yes" subtype="nosave"></td>
    </tr>
    <tr>
      <td width="20%"><div class="ExpenseTag"><span id="purpose">Purpose</span>:</div> </td>
      <td width="50%"><input type="text" name="expense_1_purpose" readonly="yes" size="40" tabindex="11" xref="expense_1_PURPOSE" subtype="nosave">
      </select></td>
      <td width="20%"></td>
      <td width="50%"></td>
    </tr>
    <tr>
      <td width="20%" class="offsetColor"><div class="ExpenseTag"><span id="comment">Comment</span>:</div> </td>
      <td width="50%" class="offsetColor"><input type="text" name="expense_1_comment" readonly="yes" size="36" tabindex="9" subtype="nosave">
      <a href="javascript:doNothing()" class="ExpenseLink" tabindex="10" onClick="initAttendeeList(document.forms[0].expense_1_attendeelist, document.forms[0].expense_1_persplit,document.forms[0].expense_1_expensetype.value,4); top.newWin = window.open('../attendeeDisplay.html', 'attendee', 'dependent=yes, width=580, height=450, screenX=580, screenY=420, titlebar=yes, menubar=no, status=no, scrollbars=yes')">&nbsp;Attendee&nbsp;List</a></td>
      <td width="20%" class="offsetColor"></td>
      <td width="50%" class="offsetColor"></td>
    </tr>
    <tr>
      <td width="20%"><div class="ExpenseTag"><span id="billable"><script>document.write(parent.contents.getBillableLabel())</script></span>:</div></td>
      <td width="50%"><input type="text" name="expense_1_billtype" readonly="yes" size="8" tabindex="13" subtype="nosave" listtype="value-in"></td>
      <td width="20%"></td>
      <td width="50%"></td>
    </tr>
    <tr>
      <td width="25%" class="offsetColor"><div class="ExpenseTag"><span id="departmentNum">Department #</span>:</div></td>
      <td width="50%" class="offsetColor"><input type="text" name="expense_1_depart" readonly="yes" size="20" onChange="departMapping(expense_1_depart, departname)" subtype="nosave">
      </td>
      <td width="20%" class="offsetColor"><div class="ExpenseTag"><span id="depart">Depart Name</span>:</div></td>
      <td width="50%" class="offsetColor"><input type="text" name="departname" readonly="yes" size="24" tabindex="-1" readOnly="yes" subtype="nosave"></td>
    </tr>
  </table>
</form>

<p align="center"><a href="javascript: void history.go(BackSpaceToReport)" tabindex="16"><em><strong><span id="returnRepDis">Return to report display</span></strong></em></a></p>

<p align="center">&nbsp;</p>

<p align="center">&nbsp;</p>
</body>
<script LANGUAGE="JavaScript" SRC="../calendar.js"></script>
<script LANGUAGE="JavaScript" SRC="../attendee.js"></script>
<script LANGUAGE="JavaScript" SRC="../addmerchant.js"></script>
<script LANGUAGE="JavaScript" SRC="../adddepart.js"></script>
<script LANGUAGE="JavaScript" SRC="../validation.js"></script>
<script LANGUAGE="JavaScript" SRC="../fx1.js"></script>
<script LANGUAGE="JavaScript">

function initForm() {
	document.getElementById("receiptMaj").innerHTML = parent.contents.getJSX("receiptMaj");
	document.getElementById("refer").innerHTML = parent.contents.getJSX("refer");
	document.getElementById("receiptInt").innerHTML = parent.contents.getJSX("receiptInt");
	document.getElementById("receiptDate").innerHTML = parent.contents.getJSX("receiptDate");
	document.getElementById("currency").innerHTML = parent.contents.getJSX("currency");
	document.getElementById("paidBy").innerHTML = parent.contents.getJSX("paidBy");
	document.getElementById("merchant").innerHTML = parent.contents.getJSX("merchant");
	document.getElementById("expenseAccLis").innerHTML = parent.contents.getJSX("expenseAccLis");
	document.getElementById("expenses").innerHTML = parent.contents.getJSX("expenses");
	document.getElementById("remainingDis").innerHTML = parent.contents.getJSX("remainingDis");
	document.getElementById("expdate").innerHTML = parent.contents.getJSX("expdate");
	document.getElementById("expenseType").innerHTML = parent.contents.getJSX("expenseType");
	document.getElementById("purpose").innerHTML = parent.contents.getJSX("purpose");
	document.getElementById("comment").innerHTML = parent.contents.getJSX("comment");
	document.getElementById("departmentNum").innerHTML = parent.contents.getJSX("departmentNum");
	document.getElementById("depart").innerHTML = parent.contents.getJSX("depart");
	document.getElementById("returnRepDis").innerHTML = parent.contents.getJSX("returnRepDis");
	document.getElementById("billable").innerHTML = parent.contents.getJSX("billable");
	document.getElementById("okref").innerHTML = parent.contents.getJSX("okRef");

	getElementByClass("lodgingOnl");
	getElementByClass("foreignAmo");
	getElementByClass("No");
	getElementByClass("Yes");
	
}

var allHTMLTags = new Array();
function getElementByClass(theClass) {
    //Create Array of All HTML Tags
    var allHTMLTags=document.getElementsByTagName("*");

    //Loop through all tags using a for loop
    for (i=0; i<allHTMLTags.length; i++) {
		
		//Get all tags with the specified class name.
		if (allHTMLTags[i].className==theClass) {
			
			//Place any code you want to apply to all
			//pages with the class specified.
			//In this example is to "display:none;" them
			//Making them all dissapear on the page.
			allHTMLTags[i].innerHTML = parent.contents.getJSX(theClass);
		}
    }
}

function applyUpdate(obj) {  //Make this more sophisticated to account for changes.
  if (parent.contents.isNew()) {
    obj.value = "insert";
  } else {
    obj.value = "update";
  }
}

function setSingleExpense() {
  if (document.forms[0].displaylist.length == 1) {
    if (confirm("Do you want to automatically adjust the expense amount?") == true) {
      document.forms[0].displaylist.selectedIndex = 0;
      loadExpense();
      document.forms[0].expense_1_amount.value = document.forms[0].AMOUNT.value;
      document.forms[0].expense_1_rec_amt.value = document.forms[0].REC_AMT.value;
      addExpense();
      document.forms[0].displaylist.selectedIndex = -1;
    }
  } else if (document.forms[0].displaylist.length == 0) {
    document.forms[0].expense_1_amount.value = document.forms[0].AMOUNT.value;
    document.forms[0].expense_1_rec_amt.value = document.forms[0].REC_AMT.value;
  }
}

function CheckAmountAndDisburse(tag) {
  var retVal = CheckAmount(tag);   
  if (retVal) {
    checkDisburse(document.forms[0].AMOUNT,document.forms[0].displaylist,"AMOUNT",document.forms[0].expense_1_disburse);
  }
  return retVal;
}

function checkDisburse(xObj, yListObj, zAmount, updateObj) {
  var ExpSum = getTotals(yListObj,"AMOUNT");
  var RecSum = parseFloat(xObj.value);
  ExpSum = RecSum - ExpSum;
  updateObj.value = ExpSum
  parent.contents.makeCurrency(updateObj);  //rounding??
  return;
}
function CheckAmount(tag) {
  //return parent.contents.checkAmtFldOK(tag);
  return true;
}

function checkTotals(xObj, yListObj, zAmount) {
  var ExpSum = getTotals(yListObj,"AMOUNT");
  var RecSum = parseFloat(xObj.value);
  var retVal = true;
  if (ExpSum - RecSum > .005 || RecSum - ExpSum > 0.005) {
    alert("Expense and Receipt amounts are different by: " + (ExpSum - RecSum));
    retVal = false;
  }
  return retVal;
}

function getTotals(yListObj, zItemName) {
  var Sum = 0;
  var x;
  for (var i = 0; i < yListObj.length; i++) {
    x = eval(yListObj.options[i].value);
    Sum = Sum + parseFloat(parent.contents.getNumericValue(x,zItemName));
  }
  return Sum;
}

function loadExpense() {
  with (document.forms[0]) {  
   if (displaylist.selectedIndex > -1) {
     blankExpense();
     var dBase = eval(displaylist.options[displaylist.selectedIndex].value);
     var dBase1 = dBase[1];
     expense_1_expdate.value = parent.contents.getDBValue(dBase1, "EXP_DATE");
     expense_1_credate.value = parent.contents.getDBValue(dBase1, "CRE_DATE");
     expense_1_expensetype.value = parent.contents.getDBValue(dBase1, "EXPENSE");
     expense_1_amount.value = parent.contents.getDBValue(dBase1, "AMOUNT");
     expense_1_rec_amt.value = parent.contents.getDBValue(dBase1, "REC_AMT");
     expense_1_purpose.value = parent.contents.getDBValue(dBase1, "PURPOSE");  
     expense_1_comment.value = parent.contents.getDBValue(dBase1, "COMMENT");
     expense_1_depart.value = parent.contents.getDBValue(dBase1, "DEPART");
     expense_1_persplit.value = parent.contents.getDBValue(dBase1, "PERSPLIT");
     departMapping(expense_1_depart, departname);
     expense_1_attendeelist.value = parent.contents.setArray2Str(parent.contents.getDBString(dBase1, "attendeelist",[]));
     expense_1_billtype.value = parent.contents.getDBSingle(dBase1, "BILLTYPE");
     if (isEmpty(UNITS.value)) { //uncommented JH 2006-02-19
        expense_1_rec_amt.value = "";
     }
     // expense_1_purpose.value = parent.contents.getStringFmHeadWhere("PURPOSE", expense_1_purpose.value);
     expense_1_purpose.value = parent.contents.getStringFmHeadWhere("PURPOSE", expense_1_purpose.value, [["PURPOSE",0],["BEG_DATE",0],["END_DATE",0],["COMMENT",15]]);
     expense_1_billtype.value = parent.contents.getBillXlate(expense_1_billtype.value);
   }
  }
}

function blankExpense() {
 with (document.forms[0]) {
   expense_1_expdate.value = REC_DATE.value; 
   expense_1_credate.value = CRE_DATE.value;
   expense_1_expensetype.selectedIndex = 0;
   expense_1_amount.value = "";
   expense_1_rec_amt.value = "";
   expense_1_purpose.selectedIndex = expense_1_purpose.length - 1; 
   expense_1_comment.value = "";
   expense_1_depart.value = "";
   departname.value = "";
   expense_1_attendeelist.value = "[]";
   expense_1_billtype.selectedIndex = 1;
   expense_1_persistance.value = "insert";
 }
}

var BackSpaceToReport = parent.contents.BackSpaceToReport;
parent.contents.BackSpaceToReport = -2;
function FillForm() {

  if (parent.contents.HeadList.length > 0) {

    document.forms[0].displaylist.subtype = "list";
    document.forms[0].expense_1_attendeelist.subtype = "nosave";
    document.forms[0].expense_1_persplit.subtype = "nosave";
    document.forms[0].expense_1_persistance.subtype = "nosave";
    document.forms[0].expense_1_disburse.subtype = "nosave";
    document.forms[0].expense_1_expdate.subtype = "nosave";
    document.forms[0].expense_1_expensetype.subtype = "nosave";
    document.forms[0].expense_1_billtype.subtype = "nosave";
    document.forms[0].expense_1_amount.subtype = "nosave";
    document.forms[0].expense_1_rec_amt.subtype = "nosave";
    document.forms[0].expense_1_purpose.subtype = "nosave";
    document.forms[0].expense_1_comment.subtype = "nosave";
    document.forms[0].expense_1_depart.subtype = "nosave";     //jh 1-29-07
    document.forms[0].departname.subtype = "nosave";           //jh 1-29-07

    //Gets a simple list found in personal.js
    document.forms[0].RCPTTYPE.value = "1";  //
    MerchantType = "location";
    parent.contents.setListWithPers(document.forms[0].LOCATION, parent.contents.getLocations("1"),MerchantType);
    
    //Brings in any transaction information (note date above can be optimized against this later)
    blankExpense();
//    cBillLoad();
    parent.contents.setTransaction(document.forms[0]);
    parent.contents.NewReport();  //JH 20070430 - Compensating for display only.
    parent.contents.ProcessHeader(parent.Header);  //JH 20070430 - Compensating for display only.
    document.forms[0].REC_DATE.focus();
// Commented out 2009-05-01 (May Day)
//    if (parent.contents.TailList.length > 0) { 
//       BackSpaceToReport = -2;
//    } else {
//       BackSpaceToReport = -3;
//    }
    CheckAmountAndDisburse(document.forms[0].AMOUNT,document.forms[0].displaylist,"AMOUNT",document.forms[0].expense_1_disburse);
    if (isEmpty(document.forms[0].UNITS.value)) document.forms[0].REC_AMT.value = "";
    parent.contents.DirectEdit = false;
  }

}

function fxCleanUp() {
  setFgnProtected(isEmpty(document.forms[0].UNITS.value),"REC_AMT","AMOUNT");
  setFgnProtected(isEmpty(document.forms[0].UNITS.value),"expense_1_rec_amt","expense_1_amount");
}

//var departList = parent.contents.getDeparts("1");
//function departMapping(obj1, obj2) {
//  if (obj1.value <= "    ") {
//    obj1.value = "";
//    obj2.value = "";
//  } else {
//    var DepartName = parent.contents.getDBString(departList,obj1.value,"Not Valid");
//    obj2.value = DepartName;
//  }
//}

function deptNotValid(obj) {
  if (obj.value.length == 1 || obj.value == "Not Valid") {
    alert("Invalid department number - please correct");
    obj.focus()
    return true;
  } else {
    return false;
  }
}

</script>

</html>
