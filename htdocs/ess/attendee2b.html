<!--
attendee2b.html - Add attendees to report/manage list fixed number    
Copyright (C) 2004 R. James Holton

This program is free software; you can redistribute it and/or modify it 
under the terms of the GNU General Public License as published by the 
Free Software Foundation; either version 2 of the License, or (at your option) 
any later version.  This program is distributed in the hope that it will be 
useful, but WITHOUT ANY WARRANTY; without even the implied warranty of 
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU General 
Public License for more details.

You should have received a copy of the GNU General Public License along with 
this program; if not, write to the Free Software Foundation, Inc., 
675 Mass Ave, Cambridge, MA 02139, USA. 
-->
<html>

<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<title>Attendee List 2b</title>
<link rel="stylesheet" href="expense.css" type="text/css"></head>

<body onLoad="getForm()">

<form>
  <table border="0" cellspacing="0" width="540" height="525" cellpadding="0">
    <tr>
      <td width="527" height="48" class="bannerColor"><strong><em><big><big><big><font
      face="Times New Roman">Attendee List </font></big></big></big></em></strong></td>
    </tr>
    <tr>
      <td width="527" height="182"><table border="0" cellspacing="0" width="100%" height="85"
      cellpadding="0">
        <tr>
          <td width="25%" height="1"><div class="ExpenseTag">Location:</div></td>
          <td width="75%" height="1"><input type="text" name="location" size="20" subtype="textarea"></td>
        </tr>
        <tr>
          <td width="25%" height="83" class="offsetColor"><div class="ExpenseTag">Discussion:</div></td>
          <td width="75%" height="83" class="offsetColor"><textarea rows="3" name="comment" cols="45" subtype="textarea"></textarea></td>
        </tr>
        <tr>
          <td width="25%" height="19"><div class="ExpenseTag">Total Attendees: </div></td>
          <td width="75%" height="19"><table border="0" cellspacing="0" width="100%" cellpadding="0">
            <tr>
              <td width="20%"><input type="text" name="number" size="6" subtype="textarea"></td>
              <td width="80%"><em><strong><font face="Arial"><small>List attendees below.&nbsp; If more
              than seven attendees, click the "Add more attendees" link.
              &quot;List Name&quot; is required. Reuse of names will overwrite any existing list with
              the same name. </small></font></strong></em></td>
            </tr>
          </table>
          </td>
        </tr>
      </table>
      </td>
    </tr>
    <tr>
      <td width="527" height="180"><table border="0" cellspacing="0" width="100%"
      cellpadding="0" height="241">
        <tr>
          <td width="58%" height="42">&nbsp;<table border="0" cellpadding="0" cellspacing="0" width="100%">
            <tr>
              <td width="37%"><strong>List Name:</strong></td>
              <td width="63%"><input type="text" name="listname" size="13"></td>
            </tr>
          </table>
          </td>
          <td width="37%" align="center" height="42"></td>
          <td width="72%" align="center" height="42"></td>
        </tr>
        <tr>
          <td width="58%" class="offsetColor" align="center" height="24"><u><div class="ExpenseTag">Person</div></u></td>
          <td width="37%" class="offsetColor" align="center" height="24"><u><div class="ExpenseTag">Title</div></u></td>
          <td width="72%" class="offsetColor" align="center" height="24"><u><div class="ExpenseTag">Company</div></u></td>
        </tr>
        <tr align="center">
          <td width="58%" height="25"><input type="text" name="attendee_1_name" size="21"></td>
          <td width="37%" height="25"><input type="text" name="attendee_1_title" size="11"></td>
          <td width="72%" height="25"><input type="text" name="attendee_1_company" size="21"></td>
        </tr>
        <tr align="center">
          <td width="58%" class="offsetColor" height="25"><input type="text" name="attendee_2_name"
          size="21"></td>
          <td width="37%" class="offsetColor" height="25"><input type="text" name="attendee_2_title"
          size="11"></td>
          <td width="72%" class="offsetColor" height="25"><input type="text" name="attendee_2_company"
          size="21"></td>
        </tr>
        <tr align="center">
          <td width="58%" height="25"><input type="text" name="attendee_3_name" size="21"></td>
          <td width="37%" height="25"><input type="text" name="attendee_3_title" size="11"></td>
          <td width="72%" height="25"><input type="text" name="attendee_3_company" size="21"></td>
        </tr>
        <tr align="center">
          <td width="58%" class="offsetColor" height="25"><input type="text" name="attendee_4_name"
          size="21"></td>
          <td width="37%" class="offsetColor" height="25"><input type="text" name="attendee_4_title"
          size="11"></td>
          <td width="72%" class="offsetColor" height="25"><input type="text" name="attendee_4_company"
          size="21"></td>
        </tr>
        <tr align="center">
          <td width="58%" height="25"><input type="text" name="attendee_5_name" size="21"></td>
          <td width="37%" height="25"><input type="text" name="attendee_5_title" size="11"></td>
          <td width="72%" height="25"><input type="text" name="attendee_5_company" size="21"></td>
        </tr>
        <tr align="center">
          <td width="58%" class="offsetColor" height="25"><input type="text" name="attendee_6_name"
          size="21"></td>
          <td width="37%" class="offsetColor" height="25"><input type="text" name="attendee_6_title"
          size="11"></td>
          <td width="72%" class="offsetColor" height="25"><input type="text" name="attendee_6_company"
          size="21"></td>
        </tr>
        <tr align="center">
          <td width="58%" height="25"><input type="text" name="attendee_7_name" size="21"></td>
          <td width="37%" height="25"><input type="text" name="attendee_7_title" size="11"></td>
          <td width="72%" height="25"><input type="text" name="attendee_7_company" size="21"></td>
        </tr>
      </table>
      </td>
    </tr>
    <tr align="center">
      <td width="527" height="25" class="offsetColor"><div align="center"><center><p><input
      type="button" value="Save to report and make list permanent" name="SaveButton"
      onClick="javascript: void saveForm()"></td>
    </tr>
  </table>
  </center></div>
</form>
<script>

function saveForm(){
  if (CheckLocation(document.forms[0].location)
   && CheckDiscussion(document.forms[0].comment)
   && CheckNumber(document.forms[0].number)
   && CheckPerson(document.forms[0].attendee_1_name)
   && CheckComplete()) {
    if (document.forms[0].listname.value > " ") {
      var y = setVarString();
      window.opener.setAttendeeList(y, document.forms[0].number.value);  
      var x = new Array();
      with (document.forms[0]) {  
        singleCell(x,"listname",listname.value);
        singleCell(x,"attendee_1_name", attendee_1_name.value);
        singleCell(x,"attendee_1_title", attendee_1_title.value);
        singleCell(x,"attendee_1_company", attendee_1_company.value);
        singleCell(x,"attendee_2_name", attendee_2_name.value);
        singleCell(x,"attendee_2_title", attendee_2_title.value);
        singleCell(x,"attendee_2_company", attendee_2_company.value);
        singleCell(x,"attendee_3_name", attendee_3_name.value);
        singleCell(x,"attendee_3_title", attendee_3_title.value);
        singleCell(x,"attendee_3_company", attendee_3_company.value);
        singleCell(x,"attendee_4_name", attendee_4_name.value);
        singleCell(x,"attendee_4_title", attendee_4_title.value);
        singleCell(x,"attendee_4_company", attendee_4_company.value);
        singleCell(x,"attendee_5_name", attendee_5_name.value);
        singleCell(x,"attendee_5_title", attendee_5_title.value);
        singleCell(x,"attendee_5_company", attendee_5_company.value);
        singleCell(x,"attendee_6_name", attendee_6_name.value);
        singleCell(x,"attendee_6_title", attendee_6_title.value);
        singleCell(x,"attendee_6_company", attendee_6_company.value);
        singleCell(x,"attendee_7_name", attendee_7_name.value);
        singleCell(x,"attendee_7_title", attendee_7_title.value);
        singleCell(x,"attendee_7_company", attendee_7_company.value);
        window.opener.setPeopleList("peoplelist","listname",listname.value,setToString(x));
      }  
      window.close();
    } else {
      alert("A list name between 1 and 16 characters is required");
      document.forms[0].listname.focus(); 
    }
  }
}
function CheckDiscussion(tag) {
  if (!window.opener.AttendRequired) return true;
  return CheckRequired(tag,10,"Need to state the discussion that took place");
}
function CheckLocation(tag) {
  if (!window.opener.AttendRequired) return true;
  return CheckRequired(tag,5,"Need to provide location of the event");
}
function CheckPerson(tag) {
  return CheckRequired(tag,5,"Need to provide name of an individual");
}
function CheckNumber(tag) {
  var retVal = true;
  var xStr = tag.value;
  var x = Number(xStr);

  if (isNaN(x) || x < 1 || xStr.indexOf(".") > -1) {
     if (isNaN(x) && x != "") {
       alert("Invalid number in Total Attendees field.");
     } else if (xStr.indexOf(".") > -1 && x != "") {
       alert("Must have an integer in Total Attendees field.  Decimal point is not allowed.");
     } else {
       alert("Need to provide positive number in Total Attendees field.");
     }
     tag.select();
     retVal = false;
//  } else {
//     if (x > 8) {
//       alert("Number in Total Attendees field is too large.")
//       tag.select();
//       retVal = false;
//     }  
  }
  return retVal;
}
function CheckRequired(tag, minichars, msgtext) {
  var Check = tag.value;
  if (Check.length < minichars) {
     alert(msgtext + " of at least " + minichars + " characters." );
     tag.focus();
     tag.select();
     return false;
  } else {
     return true;
  }
}

function CheckComplete(x,y,z) {

  var titleReq = true;
  if (window.opener.parent.contents.getRequiredItem) titleReq = window.opener.parent.contents.getRequiredItem("title");

  retVal = true;
  if (x == null)
  {
    with (document.forms[0]) {
      retVal = retVal && CheckComplete(attendee_1_name,attendee_1_title,attendee_1_company);
      retVal = retVal && CheckComplete(attendee_2_name,attendee_2_title,attendee_2_company);
      retVal = retVal && CheckComplete(attendee_3_name,attendee_3_title,attendee_3_company);
      retVal = retVal && CheckComplete(attendee_4_name,attendee_4_title,attendee_4_company);
      retVal = retVal && CheckComplete(attendee_5_name,attendee_5_title,attendee_5_company);
      retVal = retVal && CheckComplete(attendee_6_name,attendee_6_title,attendee_6_company);
      retVal = retVal && CheckComplete(attendee_7_name,attendee_7_title,attendee_7_company);
    }
  } else {
    var cName = opener.parent.contents.alltrim(x.value);
    var cTitle = opener.parent.contents.alltrim(y.value);
    var cCompany = opener.parent.contents.alltrim(z.value);
    if (cName.length > 0 && ((cTitle.length == 0 && titleReq) || cCompany.length == 0)) {
      retVal = false;
      alert("Attendee information not complete for " + cName);
      x.focus();
    }
  }
  return retVal;
}
function singleCell(x,y,z) {
  if (z != null && z > "") {
    var i = x.length;
    x.length = i + 1;
    x[i] = [y,z];
  }  
}    

var O = "["; //These are the standard delimiters,etc.
var C = "]"; //and they are used below for formatting.
var D = ",";
var Q = "'";

function setVarString() {
//gets form and places it into a string array
    var ThisTrans = new Array(0);
    var ThisName;
    var SubType;
    var j = 0;
    for (var i = 0; i < document.forms[0].length; i++) {
      ThisName = document.forms[0].elements[i].name;
      if (document.forms[0].elements[i].subtype){
        SubType = document.forms[0].elements[i].subtype;
      } else {
        SubType = document.forms[0].elements[i].type;
      } 
      switch (SubType) {
        case "text":      
            ThisTrans[j] = Array(ThisName, window.opener.parent.contents.getNormalizeText(document.forms[0].elements[i].value));
            j = j + 1;
            break;    
        case "select-one":
            ThisTrans[j] = Array(ThisName, document.forms[0].elements[i].options[document.forms[0].elements[i].selectedIndex].text);
            j = j + 1;            
            if (document.forms[0].elements[i].xref) {           
                ThisTrans[j] = Array(document.forms[0].elements[i].xref, document.forms[0].elements[i].options[document.forms[0].elements[i].selectedIndex].value);
                j = j + 1;
            } 
            break;
        case "textarea":      
            ThisTrans[j] = Array(ThisName, document.forms[0].elements[i].value);
            j = j + 1;
            break;    
        case "hidden":      
            ThisTrans[j] = Array(ThisName, document.forms[0].elements[i].value);
            j = j + 1;
            break;
        case "exclude":   // only xref on an excluded select-one list is processed
            if (document.forms[0].elements[i].xref) {           
                ThisTrans[j] = Array(document.forms[0].elements[i].xref, document.forms[0].elements[i].options[document.forms[0].elements[i].selectedIndex].value);
                j = j + 1;
            }
            break;    
        case "radio": // not implemented yet
            break;
        case "checkbox": // not implemented yet
            break;
        case "button": // don't capture any of the following
            break;
        case "submit":
            break;
        case "reset":
            break;
        default:
            alert("Field '" + SubType + "' not anticipated by UpdateReport() in : " + TransType);
      }
    }
    return setToString(ThisTrans);
}

function setToString(TList) {  //similar function in common.js
  var outstring = O;  //could be modularized
  var idelimit = "";
  var processStr = "";
  var regexp ;
  for (var i = 0; i < TList.length; i++) {
    if (TList[i][1].length > 0) {
      outstring += idelimit; 
      outstring += O + Q + TList[i][0] + Q + D;   
      processStr = TList[i][1];
      regexp = /'/g ;
      processStr = processStr.replace(regexp,"");
      regexp = /\n/g ;
      processStr = processStr.replace(regexp,"\\n");
      regexp = /\r/g ;
      processStr = processStr.replace(regexp,"");
      regexp = /"/g ;
      processStr = processStr.replace(regexp,"");
      regexp = /\]/g ;
      processStr = processStr.replace(regexp,")");
      regexp = /\[/g ;
      processStr = processStr.replace(regexp,"(");
      outstring += Q + processStr + Q + C;  // wanted &#39 but using ""
      idelimit = D;   
    }
  }
  return outstring + C;
}

function setTransaction(ListBuffer) {
  var j;
  for (var i = 0; i < ListBuffer.length; i++) {
    if (document.forms[0].elements[ListBuffer[i][0]]) {
      switch (document.forms[0].elements[ListBuffer[i][0]].type) {
        case "text":  
           document.forms[0].elements[ListBuffer[i][0]].value = ListBuffer[i][1];
           break;    
        case "textarea":  
           document.forms[0].elements[ListBuffer[i][0]].value = ListBuffer[i][1];
           break;    
        case "select-one":
           for (var j = 0;j < document.forms[0].elements[ListBuffer[i][0]].length; j++)  {
             if (document.forms[0].elements[ListBuffer[i][0]].options[j].text == ListBuffer[i][1]) {
               document.forms[0].elements[ListBuffer[i][0]].selectedIndex = j;
               j = document.forms[0].elements[ListBuffer[i][0]].length;
             }
           } 
           break;
        case "hidden": 
           document.forms[0].elements[ListBuffer[i][0]].value = ListBuffer[i][1];
           break; 
        default:
          alert("Form: cannot load " + ListBuffer[i][0] + ", type:" + ListBuffer[i].type + ", value:" + ListBuffer[i].value);
      }  //need to add the other types eventually
    }
  }
}
function getForm() {
   Y = 605;
   if (screen.height < 605) Y = screen.height - 10;
   window.resizeTo(600, Y);
   var TList; 
   eval("TList = " + window.opener.parent.contents.getDBValue(window.opener.parent.WorkDBase,"peoplelist")); 
   setTransaction(TList);
}

</script>

</body>
</html>
