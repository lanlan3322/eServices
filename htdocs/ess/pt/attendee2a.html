<!--
attendee2a.html - Add attendees to report/fixed number     
Copyright (C) 2004 R. James Holton

This program is free software; you can redistribute it and/or modify it 
under the terms of the GNU General Public License as published by the 
Free Software Foundation; either version 2 of the License, or (at your option) 
any later version.  This program is distributed in the hope that it will be 
useful, but WITHOUT ANY WARRANTY; without even the implied warranty of 
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU General 
Public License for more details.

You should have received a copy of the GNU General Public License along with 
this program; if not, write to the Free Software Foundation, Inc., 
675 Mass Ave, Cambridge, MA 02139, USA. 
-->
<html>

<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<title>Lista de Participantes (2a)</title>
<link rel="stylesheet" href="expense.css" type="text/css"></head>

<body onLoad="getForm()">

<form>
  <table border="0" cellspacing="0" width="540" height="514" cellpadding="0">
    <tr>
      <td width="500" height="48" class="bannerColor"><strong><em><big><big><big><font face="Times New Roman">Lista de Participantes </font></big></big></big></em></strong></td>
    </tr>
    <tr>
      <td width="500" height="182"><table border="0" cellspacing="0" width="100%" height="85" cellpadding="0">
        <tr>
          <td width="25%" height="1"><div class="ExpenseTag">Local:</div></td>
          <td width="75%" height="1"><input type="text" name="location" size="20" subtype="textarea"></td>
        </tr>
        <tr>
          <td width="25%" height="83" class="offsetColor"><div class="ExpenseTag">Pauta:</div></td>
          <td width="75%" height="83" class="offsetColor"><textarea rows="3" name="comment" cols="45"  subtype="textarea"></textarea></td>
        </tr>
        <tr>
          <td width="25%" height="19"><div class="ExpenseTag">Total de Participantes: </div></td>
          <td width="75%" height="19"><table border="0" cellspacing="0" width="100%" cellpadding="0">
            <tr>
              <td width="20%"><input type="text" name="number" size="6" subtype="textarea"></td>
              <td width="80%"><em><strong><font face="Arial"><small>Lista de Participantes.&nbsp; Se mais
              de 7 participantes, clique em &quot;Adicionar Participante&quot;.
              &quot;Usar Lista&quot; &eacute; opcional e permitirá o preenchimento do formul&aacute;rio com Participantes
              da lista permanente. </small></font></strong></em></td>
            </tr>
          </table>
          </td>
        </tr>
      </table>
      </td>
    </tr>
    <tr>
      <td width="500" height="180"><table border="0" cellspacing="0" width="100%" cellpadding="0" height="241">
        <tr>
          <td width="58%" height="42"></td>
          <td width="37%" align="center" height="42"></td>
          <td width="72%" align="center" height="42"><table border="0" cellpadding="0" cellspacing="0" width="100%">
            <tr>
              <td width="29%"><strong>Usar&nbsp; Lista:</strong></td>
              <td width="71%"><select name="listname" size="1" onChange="setPeopleList()">
              </select></td>
            </tr>
          </table>
          </td>
        </tr>
        <tr>
          <td width="58%" class="offsetColor" align="center" height="24"><u><div class="ExpenseTag">Participante</div></u></td>
          <td width="37%" class="offsetColor" align="center" height="24"><u><div class="ExpenseTag">Cargo</div></u></td>
          <td width="72%" class="offsetColor" align="center" height="24"><u><div class="ExpenseTag">Empresa</div></u></td>
        </tr>
        <tr align="center">
          <td width="58%" height="25"><input type="text" name="attendee_1_name" size="21"></td>
          <td width="37%" height="25"><input type="text" name="attendee_1_title" size="11"></td>
          <td width="72%" height="25"><input type="text" name="attendee_1_company" size="21"></td>
        </tr>
        <tr align="center">
          <td width="58%" class="offsetColor" height="25"><input type="text" name="attendee_2_name" size="21"></td>
          <td width="37%" class="offsetColor" height="25"><input type="text" name="attendee_2_title" size="11"></td>
          <td width="72%" class="offsetColor" height="25"><input type="text" name="attendee_2_company" size="21"></td>
        </tr>
        <tr align="center">
          <td width="58%" height="25"><input type="text" name="attendee_3_name" size="21"></td>
          <td width="37%" height="25"><input type="text" name="attendee_3_title" size="11"></td>
          <td width="72%" height="25"><input type="text" name="attendee_3_company" size="21"></td>
        </tr>
        <tr align="center">
          <td width="58%" class="offsetColor" height="25"><input type="text" name="attendee_4_name" size="21"></td>
          <td width="37%" class="offsetColor" height="25"><input type="text" name="attendee_4_title" size="11"></td>
          <td width="72%" class="offsetColor" height="25"><input type="text" name="attendee_4_company" size="21"></td>
        </tr>
        <tr align="center">
          <td width="58%" height="25"><input type="text" name="attendee_5_name" size="21"></td>
          <td width="37%" height="25"><input type="text" name="attendee_5_title" size="11"></td>
          <td width="72%" height="25"><input type="text" name="attendee_5_company" size="21"></td>
        </tr>
        <tr align="center">
          <td width="58%" class="offsetColor" height="25"><input type="text" name="attendee_6_name" size="21"></td>
          <td width="37%" class="offsetColor" height="25"><input type="text" name="attendee_6_title" size="11"></td>
          <td width="72%" class="offsetColor" height="25"><input type="text" name="attendee_6_company" size="21"></td>
        </tr>
        <tr align="center">
          <td width="58%" height="25"><input type="text" name="attendee_7_name" size="21"></td>
          <td width="37%" height="25"><input type="text" name="attendee_7_title" size="11"></td>
          <td width="72%" height="25"><input type="text" name="attendee_7_company" size="21"></td>
        </tr>
      </table>
      </td>
    </tr>
    <tr align="center">
      <td width="500" height="25" class="offsetColor">
      <input type="button" value="Salvar Participantes no Relat&oacute;rio" name="SaveButton" onClick="javascript: void saveForm()"></td>
    </tr>
    <tr>
      <table width="100%" border="0" cellspacing="0" cellpadding="0">
      <tr> 
      <td width="50%" height="25" class="offsetColor" align="left">
      <a HREF="javascript: void longList()"><em>Incluir Participante</em></a></td>
      <td width="50%" height="25" class="offsetColor" align="right">
      <a HREF="javascript: void newList()"><em>Lista Permanente</em></a></td>
      </tr>
      </table>
    </tr>
  </table>
</form>
<script>

function newList() {
  if (CheckComplete()) { 
    window.opener.parent.contents.setDBPair(window.opener.parent.WorkDBase,"peoplelist",setVarString());
    window.location = "attendee2b.html";
  }
}

function longList() {
  if (CheckComplete()) { 
    window.opener.parent.contents.setDBPair(window.opener.parent.WorkDBase,"peoplelist",setSpecialStr());
    window.location = "attendee3a.html";
  }
}

function saveForm() {
  if (CheckLocation(document.forms[0].location)
   && CheckDiscussion(document.forms[0].comment)
   && CheckNumber(document.forms[0].number)
   && CheckPerson(document.forms[0].attendee_1_name)
   && CheckComplete()) {
   window.opener.setAttendeeList(setVarString(), document.forms[0].number.value);
   window.close();
  }
}
function CheckDiscussion(tag) {
  if (!window.opener.AttendRequired) return true;
  return CheckRequired(tag,10,"Need to state the discussion that took place");
}
function CheckLocation(tag) {
  if (!window.opener.AttendRequired) return true;
  return CheckRequired(tag,5,"Need to provide location of the event");
}
function CheckPerson(tag) {
  return CheckRequired(tag,5,"Need to provide name of an individual");
}
function CheckNumber(tag) {
  var retVal = true;
  var xStr = tag.value;
  var x = Number(xStr);

  if (isNaN(x) || x < 1 || xStr.indexOf(".") > -1) {
     if (isNaN(x) && x != "") {
       alert("Invalid number in Total Attendees field.");
     } else if (xStr.indexOf(".") > -1 && x != "") {
       alert("Must have an integer in Total Attendees field.  Decimal point is not allowed.");
     } else {
       alert("Need to provide positive number in Total Attendees field.");
     }
     tag.select();
     retVal = false;
//  } else {
//     if (x > 8) {
//       alert("Number in Total Attendees field is too large.");
//       tag.select();
//       retVal = false;
//     }  
  }
  return retVal;
}
function CheckRequired(tag, minichars, msgtext) {
  var Check = tag.value;
  if (Check.length < minichars) {
     alert(msgtext + " of at least " + minichars + " characters." );
     tag.focus();
     tag.select();
     return false;
  } else {
     return true;
  }
}

function CheckComplete(x,y,z) {

  var titleReq = true;
  if (window.opener.parent.contents.getRequiredItem) titleReq = window.opener.parent.contents.getRequiredItem("title");

  retVal = true;
  if (x == null)
  {
    with (document.forms[0]) {
      retVal = retVal && CheckComplete(attendee_1_name,attendee_1_title,attendee_1_company);
      retVal = retVal && CheckComplete(attendee_2_name,attendee_2_title,attendee_2_company);
      retVal = retVal && CheckComplete(attendee_3_name,attendee_3_title,attendee_3_company);
      retVal = retVal && CheckComplete(attendee_4_name,attendee_4_title,attendee_4_company);
      retVal = retVal && CheckComplete(attendee_5_name,attendee_5_title,attendee_5_company);
      retVal = retVal && CheckComplete(attendee_6_name,attendee_6_title,attendee_6_company);
      retVal = retVal && CheckComplete(attendee_7_name,attendee_7_title,attendee_7_company);
    }
  } else {
    var cName = opener.parent.contents.alltrim(x.value);
    var cTitle = opener.parent.contents.alltrim(y.value);
    var cCompany = opener.parent.contents.alltrim(z.value);
    if (cName.length > 0 && ((cTitle.length == 0 && titleReq) || cCompany.length == 0)) {
      retVal = false;
      alert("Attendee information not complete for " + cName);
      x.focus();
    }
  }
  return retVal;
}


function setPeopleList() {
  if (document.forms[0].listname.selectedIndex > 0) {      
    with (document.forms[0]) {
      attendee_1_name.value = "";
      attendee_1_title.value = "";
      attendee_1_company.value = "";
      attendee_2_name.value = "";
      attendee_2_title.value = "";
      attendee_2_company.value = ""; 
      attendee_3_name.value = "";
      attendee_3_title.value = "";
      attendee_3_company.value = ""; 
      attendee_4_name.value = "";
      attendee_4_title.value = "";
      attendee_4_company.value = ""; 
      attendee_5_name.value = "";
      attendee_5_title.value = "";
      attendee_5_company.value = ""; 
      attendee_6_name.value = "";
      attendee_6_title.value = "";
      attendee_6_company.value = ""; 
      attendee_7_name.value = "";
      attendee_7_title.value = "";
      attendee_7_company.value = ""; 
      var x = document.forms[0].listname.options[document.forms[0].listname.selectedIndex].text;
    }  
    var y = window.opener.parent.contents.getDBWhere(window.opener.parent.PersDBase,"peoplelist","listname",x); 
    if (y.length > 0) {
       var W = window.opener.parent.contents.getDBResult(y[0],"attendee");
       if (W.length > 0) {
         window.opener.parent.contents.setDBPair(window.opener.parent.WorkDBase,"peoplelist",transferList(y[0]));
         window.location = "attendee3a.html";
       } else {
         setTransaction(y[0]);
       }
    }
  }  
}    

function setSpecialStr() {
 var xStr = "";
 with (document.forms[0]) {
   xStr += O + strPair("location", location.value);
   xStr += D + strPair("comment", rmSpcChars(comment.value));
   xStr += D + strPair("number", number.value);
   xStr += D + strPair("listname", listname.options[listname.selectedIndex].text);
   xStr += strAttendee(attendee_1_name.value,attendee_1_title.value,attendee_1_company.value);
   xStr += strAttendee(attendee_2_name.value,attendee_2_title.value,attendee_2_company.value);
   xStr += strAttendee(attendee_3_name.value,attendee_3_title.value,attendee_3_company.value);
   xStr += strAttendee(attendee_4_name.value,attendee_4_title.value,attendee_4_company.value);
   xStr += strAttendee(attendee_5_name.value,attendee_5_title.value,attendee_5_company.value);
   xStr += strAttendee(attendee_6_name.value,attendee_6_title.value,attendee_6_company.value);
   xStr += strAttendee(attendee_7_name.value,attendee_7_title.value,attendee_7_company.value);
   xStr += C;
 }
 return xStr;
}

function strAttendee(x,y,z) {
 var xStr = "";
 if (x != "") {
   xStr += D + O + Q + "attendee" + Q + D + O 
   xStr += strPair("name", x) + D;
   xStr += strPair("title", y) + D; 
   xStr += strPair("company", z);
   xStr += C + C;
 }
 return xStr;
}

function strPair(x,y) {
  return O + Q + x + Q + D + Q + y + Q + C; 
}

var O = "["; //These are the standard delimiters,etc.
var C = "]"; //and they are used below for formatting.
var D = ",";
var Q = "'";

function setVarString() {
//gets form and places it into a string array
    var ThisTrans = new Array(0);
    var ThisName;
    var SubType;
    var j = 0;
    for (var i = 0; i < document.forms[0].length; i++) {
      ThisName = document.forms[0].elements[i].name;
      if (document.forms[0].elements[i].subtype){
        SubType = document.forms[0].elements[i].subtype;
      } else {
        SubType = document.forms[0].elements[i].type;
      } 
      
      switch (SubType) {
        case "text":      
            ThisTrans[j] = Array(ThisName, window.opener.parent.contents.getNormalizeText(document.forms[0].elements[i].value));
            j = j + 1;
            break;    
        case "select-one":
            if(document.forms[0].elements[i].length > 0) {
              ThisTrans[j] = Array(ThisName, document.forms[0].elements[i].options[document.forms[0].elements[i].selectedIndex].text);
              j = j + 1;            
              if (document.forms[0].elements[i].xref) {           
                ThisTrans[j] = Array(document.forms[0].elements[i].xref, document.forms[0].elements[i].options[document.forms[0].elements[i].selectedIndex].value);
                j = j + 1;
              } 
            }
            break;
        case "textarea":      
            ThisTrans[j] = Array(ThisName, document.forms[0].elements[i].value);
            j = j + 1;
            break;    
        case "hidden":      
            ThisTrans[j] = Array(ThisName, document.forms[0].elements[i].value);
            j = j + 1;
            break;
        case "exclude":   // only xref on an excluded select-one list is processed
            if (document.forms[0].elements[i].xref) {           
                ThisTrans[j] = Array(document.forms[0].elements[i].xref, document.forms[0].elements[i].options[document.forms[0].elements[i].selectedIndex].value);
                j = j + 1;
            }
            break;    
        case "radio": // not implemented yet
            break;
        case "checkbox": // not implemented yet
            break;
        case "button": // don't capture any of the following
            break;
        case "submit":
            break;
        case "reset":
            break;
        default:
            alert("Field '" + SubType + "' not anticipated by UpdateReport() in : " + TransType);
      }
    }
    return setToString(ThisTrans);
}

function setToString(TList) {  //similar function in common.js
  var outstring = O;  //could be modularized
  var idelimit = "";
  var processStr = "";
  for (var i = 0; i < TList.length; i++) {
    if (TList[i][1].length > 0) {
      outstring += idelimit; 
      outstring += O + Q + TList[i][0] + Q + D;   
      if (typeof TList[i][1] == "string") {
        processStr = TList[i][1];
        processStr = Q + rmSpcChars(processStr) + Q;
      } else {
        processStr = setToString(window.opener.parent.contents.getNormalizeText(TList[i][1])) 
      }
      outstring += processStr + C;  // wanted &#39 but using ""
      idelimit = D;  
    }
  }
  return outstring + C;
}


function rmSpcChars(processStr) {
     var regexp = /'/g ;
     processStr = processStr.replace(regexp,"");
     regexp = /\n/g ;
     processStr = processStr.replace(regexp,"\\n");
     regexp = /\r/g ;
     processStr = processStr.replace(regexp,"");
     regexp = /"/g ;
     processStr = processStr.replace(regexp,"");
     regexp = /\]/g ;
     processStr = processStr.replace(regexp,")");
     regexp = /\[/g ;
     processStr = processStr.replace(regexp,"(");
     return processStr;
}

function transferList(TList) {
  var outstring = "";
  outstring = O + strPair("location", document.forms[0].location.value);
  outstring += D + strPair("comment", rmSpcChars(document.forms[0].comment.value));
  outstring += D + strPair("number", document.forms[0].number.value);
  outstring += D + tailList(TList);
  outstring += C;
  return outstring;
}

function tailList(TList) {  //similar function in common.js
  var outstring = "";  //could be modularized
  var processStr = "";
  var idelimit = "";
  for (var i = 0; i < TList.length; i++) {
    if (TList[i][1].length > 0) {
      outstring += idelimit; 
      outstring += O + Q + TList[i][0] + Q + D;   
      if (typeof TList[i][1] == "string") {
        processStr = Q + TList[i][1] + Q;
      } else {
        processStr =  O + tailList(TList[i][1]) + C; 
      }
      outstring += processStr + C;  // wanted &#39 but using ""
      idelimit = D; 
    }
  }
  return outstring;
}




function setTransaction(ListBuffer) {
  var j;
  for (var i = 0; i < ListBuffer.length; i++) {
    if (document.forms[0].elements[ListBuffer[i][0]]) {
      switch (document.forms[0].elements[ListBuffer[i][0]].type) {
        case "text":  
           document.forms[0].elements[ListBuffer[i][0]].value = ListBuffer[i][1];
           break;    
        case "textarea":  
           document.forms[0].elements[ListBuffer[i][0]].value = ListBuffer[i][1];
           break;    
        case "select-one":
           for (var j = 0;j < document.forms[0].elements[ListBuffer[i][0]].length; j++)  {
             if (document.forms[0].elements[ListBuffer[i][0]].options[j].text == ListBuffer[i][1]) {
               document.forms[0].elements[ListBuffer[i][0]].selectedIndex = j;
               j = document.forms[0].elements[ListBuffer[i][0]].length;
             }
           } 
           break;
        case "hidden": 
           document.forms[0].elements[ListBuffer[i][0]].value = ListBuffer[i][1];
           break; 
        default:
          alert("Form: cannot load " + ListBuffer[i][0] + ", type:" + ListBuffer[i].type + ", value:" + ListBuffer[i].value);
      }  //need to add the other types eventually
    }
  }
}
function getForm() {
   Y = 605;
   if (screen.height < 605) Y = screen.height - 10;
   window.resizeTo(600, Y);
   var XList = [["",""]]; 
   var TList;
   window.opener.parent.contents.setListWValueWPers(document.forms[0].listname, XList,"peoplelist","listname","listname");
   document.forms[0].listname.selectedIndex = 0;
   eval("TList = " + window.opener.getAttendeeList());
   var X = window.opener.parent.contents.getDBResult(TList,"attendee");
   if (X.length > 0) {
     window.opener.parent.contents.setDBPair(window.opener.parent.WorkDBase,"peoplelist",window.opener.getAttendeeList());
     window.location = "attendee3a.html";
   } else {
     setTransaction(TList);
     window.focus();
   }
}

</script>

</body>
</html>
