<!--
combine6.html - trip with lodging wizard
Copyright (C) 2004 R. James Holton

This program is free software; you can redistribute it and/or modify it 
under the terms of the GNU General Public License as published by the 
Free Software Foundation; either version 2 of the License, or (at your option) 
any later version.  This program is distributed in the hope that it will be 
useful, but WITHOUT ANY WARRANTY; without even the implied warranty of 
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU General 
Public License for more details.

You should have received a copy of the GNU General Public License along with 
this program; if not, write to the Free Software Foundation, Inc., 
675 Mass Ave, Cambridge, MA 02139, USA. 
-->

<html>

<head>
<title>Multi-Purpose Report with Lodging</title>
<link rel="stylesheet" href="../expense.css" type="text/css"></head>

<body onLoad="javascript:void FillForm()">
<div align="right"><a href="javascript: void parent.contents.helpWindow('hcombine6.html')"><span class="ExpenseLink">Screen Help?</span></a></div>

<table border="0" cellpadding="0" cellspacing="1" width="100%" class="offsetColor">
  <tr>
    <td width="100%"><h1>Enter trip purpose and receipts:</h1></td>
  </tr>
</table>
<div class="ExpenseTag">Click a grey button at the bottom of this form to add this work to your report before selecting another menu option.</div>
<a name="purpose" />
<p>
<h2><em>Trip Purpose</em></h2>
</p>
<form name="topside">
 <input type="hidden" name="xref" value="XXX">

<table border="0" cellpadding="0" cellspacing="0" width="100%">
        <tr>
          <td width="23%" class="offsetColor" height="25"><div class="ExpenseTag">Visit From:</div></td>
          <td width="77%" class="offsetColor" height="25"><input type="text" name="begdate" size="8" value="mm/dd/yy" mysubst="1" onBlur="resetDate()" onChange="checkdate(document.forms[0].begdate)"><a HREF="javascript:doNothing()" mysubst="2" onClick="setDateField(document.forms[0].begdate);"><img SRC="../calendar.gif" BORDER="0" WIDTH="16" HEIGHT="16"></a><font size="1">Popup Calendar</font></td>
        </tr>
        <tr>
          <td width="23%" height="25"><div class="ExpenseTag">To:</div></td>
          <td width="77%" height="25"><input type="text" name="enddate" size="8" value="mm/dd/yy" mysubst="3" onBlur="endHotelDate()" onChange="checkdate(document.forms[0].enddate)"><a HREF="javascript:doNothing()" mysubst="4" onClick="setDateField(document.forms[0].enddate);"><img SRC="../calendar.gif" BORDER="0" WIDTH="16" HEIGHT="16"></a><font size="1">Popup Calendar</font></td>
        </tr>
        <tr>
          <td width="23%" height="25" class="offsetColor"><div class="ExpenseTag">Client #:</div></td>
          <td width="77%" height="25" class="offsetColor">
          <table border="0" cellpadding="0" cellspacing="0" width="100%"><tr>
          <td width="33%">
          <select name="clientno" size="1" mysubst="5" onChange="populateClientLoc()">
          </select>
          </td>
          <td class="ExpenseLink" width="67%" align="right">Lookup:&nbsp;
          <select name="clientLookup" size="1" mysubst="5" onChange="populateClientNo()" onBlur="LookupCleanup()">
          </select>
          </td>
          </tr></table>
          </td>
        </tr>
        <tr>
          <td width="23%" height="25"><div class="ExpenseTag">Client Name:</div></td>
          <td width="77%" height="25"><input type="text" name="client" size="40" mysubst="6">
          </select></td>
        </tr>
        <tr>
          <td width="23%" height="26" class="offsetColor"><div class="ExpenseTag">Location:</div></td>
          <td width="77%" height="26" class="offsetColor"><select name="location" size="1" mysubst="10">
          </select>
          <a class="ExpenseLink" href="javascript:doNothing()" mysubst="11" onClick="setLocalObj(document.forms[0].location); MerchantType = 'location';">&nbsp;New Location</a>
          </td>
        </tr>
        <tr>
          <td width="23%" height="90"><div class="ExpenseTag">Purpose or Individuals: </div></td>
          <td width="77%" height="90"><textarea rows="4" name="comment" cols="37" mysubst="8"></textarea></td>
        </tr>
        <tr>
          <td width="20%" height="25" class="offsetColor"><div class="ExpenseTag">Client Billable:</div></td>
          <td width="80%" height="25" class="offsetColor"><select name="billtype" size="1" mysubst="9" onChange="resetBillType()">
            <option value="Yes">Yes</option>
            <option selected value="No">No</option>
          </select></td>
        </tr>
            <tr>
      <td width="23%"><div class="ExpenseTag">Expense to:</div></td>
      <td width="77%">
      <table border="0" cellpadding="0" cellspacing="0" width="100%">
      <tr>
      <td width="60%">
      <select name="depart" size="1"></select>
      </td>
      <td width="40%">
      <div class="ExpenseLink">The whole report will be expensed to this department.</div>
      </td>
      </tr>
      </table>
      </td>
    </tr>

</table>
</form>
<p align="right">
<div class="ExpenseLink">
<a href="combine6.html#purpose">Purpose&nbsp;</a>
<a href="combine6.html#mileage">Mileage&nbsp;</a>
<a href="combine6.html#other">Other&nbsp;</a>
</div></p>
<a name="hotel" />
<p><h2><em>Hotel Bill</h2></p>
<form name="lodging">
<form>
  <input type="hidden" name="expense_2_attendeelist" value="[]" subtype="nosave">
  <input type="hidden" name="expense_2_persplit" value subtype="nosave">
  <input type="hidden" name="expense_1_expensetype" value>
  <input type="hidden" name="expense_1_expdate" value>
  <input type="hidden" name="rcptdate" value>
  <input type="hidden" name="charge" value>
  <input type="hidden" name="purpose" value="wizard">
  <input type="hidden" name="xref" value>
  <table border="0" width="100%" cellpadding="0" cellspacing="0">
    <tr>
      <td><table border="0" width="100%" cellpadding="0" cellspacing="0">
        <tr>
          <td width="20%" class="offsetColor"><div class="ExpenseTag">Check in:</div></td>
          <td class="ExpenseTag" width="80%" class="offsetColor"><input type="text" name="begdate1" size="10" value maxlength="10" mysubst="1" onChange="popDates()" onBlur="popDates()"><a HREF="javascript:doNothing()" mysubst="2" onClick="setDateField(document.forms[1].begdate1);"> <img SRC="../calendar.gif" BORDER="0" WIDTH="16" HEIGHT="16"></a>
          &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Check out:<input type="text" name="begdate2" size="10" value maxlength="10" mysubst="3" onChange="doubleChk(this.form.begdate2)"><a HREF="javascript:doNothing()" mysubst="4" onClick="setDateField(document.forms[1].begdate2);"> <img SRC="../calendar.gif" BORDER="0" WIDTH="16" HEIGHT="16"></a></td>
        </tr>
        <tr>
          <td width="20%"><div class="ExpenseTag">Total Receipt Amount:</div></td>
          <td width="80%"><input type="text" name="amount" size="9" value="0.00" mysubst="5" onchange="calcLodging(document.forms[1])"></td>
        </tr>
        <tr>
          <td width="20%" class="offsetColor"><div class="ExpenseTag"># Persons:</div></td>
          <td width="80%" class="offsetColor"><input type="text" name="expense_1_persplit" size="2" maxlength="8" mysubst="8"></td>
        </tr>
        <tr>
          <td width="20%"><div class="ExpenseTag">Hotel Company:</div></td>
          <td width="80%"><select name="merchant" size="1" mysubst="9">
          </select> <a class="ExpenseLink" href="javascript:doNothing()" mysubst="11" onClick="MerchantType = 'hotel';setLocalObj(document.forms[1].merchant);">&nbsp;New&nbsp;Hotel</a></td>
        </tr>
        <tr>
          <td width="20%" class="offsetColor"><div class="ExpenseTag">Comment:</div></td>
          <td width="80%" class="offsetColor"><textarea rows="3" name="expense_1_comment" cols="38" mysubst="10"></textarea></td>
        </tr>
        <tr>
          <td width="20%"><div class="ExpenseTag">Room Billable:</div></td>
          <td width="80%"><select name="expense_1_billtype" size="1" mysubst="11">
            <option value="Yes">Yes</option>
            <option selected value="No">No</option>
          </select></td>
        </tr>
        <tr>
          <td width="20%" class="offsetColor"><div class="ExpenseTag"><font color="#808080">Room Amount:</font></div></td>
          <td width="80%" class="offsetColor"><input type="text" color="#808080" name="expense_1_amount" size="8" readonly="yes"></td>
        </tr>
        <tr>
          <td width="20%">&nbsp;</div></td>
          <td width="80%"></td>
        </tr>

      </table>
      
      <table border="0" cellpadding="0" class="offsetColor">
        <tr>
          <td width="30%" class="offsetColor" align="left"><small><strong>Enter your non-room expenses from your
          hotel bill in the non-room item detail area below. Click the "Update non-room expenses" button after entering each expense. 
          Your non-room expenses will then appear in the summary list on the right.</strong></small></td>
          <td width="70%" class="offsetColor" align="left">
          <table border="0" cellpadding="0">
            <tr>
              <td width="5%">
              <td class="offsetColor" align="left" width="15%"><div class="ExpenseTag">Non-Room<br>Expense&nbsp;Summary:&nbsp;</div></td>
              <td class="offsetColor" height="26" align="left" width="50%"><select name="expenselist" size="7" tabindex="2" width="40" subtype="list" onChange="loadExpense()">
              </select></td>
              <td class="offsetColor" align="left" width="30%">
              <br>
              <input type="button" value="Remove" name="RemoveExpense" onClick="javascript: void removeExpense()"> <br>
              <br>
              <input type="button" value="  New " name="clearExpense" onClick="javascript: void newExpense()"> <br>
            </tr>
          </table>
          </td>
        </tr>
      </table>
      
      <tr><td width="100%" height="12">&nbsp;
      </td></tr>
      
      <tr><td width="100%">
      <div class="ExpenseTag">Non-Room Item Detail:</div>
      </td></tr>
      <table border="0" cellpadding="0" width="100%" class="offsetColor">
        <tr>
          <td><table border="0" cellpadding="0" width="100%">
            <tr class="offsetColor">
              <td width="25%%" align="left"><div class="ExpenseTag">Expense Date</div></td>
              <td width="25%" align="left"><div class="ExpenseTag">Amount</div></td>
              <td width="25%" align="left"><div class="ExpenseTag">Expense Type</div></td>
              <td width="25%">&nbsp;</tr>
            </tr>
            <tr>
              <td width="25%"><input type="text" name="expense_2_expdate" size="13" mysubst="12" onChange="checkdate(this.form.expense_2_expdate)" subtype="nosave"><a HREF="javascript:doNothing()" mysubst="13" onClick="setDateField(document.forms[1].expense_2_expdate);" subtype="nosave"> <img SRC="../calendar.gif" BORDER="0" WIDTH="27" HEIGHT="16"></a></td>
              <td width="25%"><input type="text" name="expense_2_amount" size="9" value="0.00" mysubst="14" onChange="calcLodging(this.form)" subtype="nosave"></td>
              <td width="25%"><select name="expense_2_expensetype" size="1" mysubst="15" subtype="nosave">
              </select></td>
              <td width="25%">&nbsp;</tr>
            </tr>
          </table>
          </td>
        </tr>
        <tr>
          <td><table border="0" cellpadding="0" width="100%" class="offsetColor">
            <tr class="offsetColor">
              <td width="10%" align="left"><div class="ExpenseTag">Bill</div></td>
              <td width="50%" align="left"><div class="ExpenseTag">Comment</div></td>
              <td width="10%" align="left"></td>
              <td width="30%" align="left"></td>
            </tr>
            <tr>
              <td width="10%"><select name="expense_2_billtype" size="1" mysubst="16" subtype="nosave">
                <option value="Yes">Yes</option>
                <option selected value="No">No</option>
              </select></td>
              <td width="50%"><input type="text" name="expense_2_comment" size="36" mysubst="17" subtype="nosave">
              <a href="javascript:doNothing()" mysubst="30" onClick="initAttendeeList(document.forms[1].expense_2_attendeelist,document.forms[1].expense_2_persplit,document.forms[1].expense_2_expensetype); top.newWin = window.open('../attendee2a.html', 'attendee', 'dependent=yes, width=600, height=605, screenX=580, screenY=420, titlebar=yes, menubar=no, status=no, scrollbars=yes')"><div class="ExpenseLink">Attendee List</div></a>
              </td><td width="10%"></td>
              <td width="30%"><input type="button" value="Update non-room expenses" name="updateExpense" onClick="javascript: void addExpense()"> </td>
            </tr>
          </table>
          </td>
        </tr>
      </table>
      </td>
    </tr>
  </table>
</form>

<p>
<p align="right">
<div class="ExpenseLink">
<a href="combine6.html#purpose">Purpose&nbsp;</a>
<a href="combine6.html#hotel">Hotel&nbsp;</a>
<a href="combine6.html#other">Other&nbsp;</a>
</div></p><a name="mileage" />
<h2><em>Car Mileage Section</em></h2>
</p>
<table border="0" width="92%" bordercolor="#FFFFFF" bordercolorlight="#FFFFFF" bordercolordark="#FFFFFF" cellspacing="0" cellpadding="2">
  <form name="mileage1">
    <input type="hidden" name="rcpttype" value="4">
    <input type="hidden" name="expense_1_expensetype" value>
    <input type="hidden" name="charge" value>
    <input type="hidden" name="units" value>
    <input type="hidden" name="expense_1_purpose" value="wizard">
    <input type="hidden" name="expense_1_xref" value>
    <tr>
      <td width="30%" class="offsetColor" align="center"><div class="ExpenseTag">Date</div></td>
      <td width="19%" class="offsetColor" align="center"><div class="ExpenseTag"><script>document.write(parent.contents.getDistanceLabel())</script></div></td>
      <td width="10%" class="offsetColor" align="center"><div class="ExpenseTag">Rate</div></td>
      <td width="10%" class="offsetColor" align="center"><div class="ExpenseTag">Amount</div></td>
      <td width="10%" class="offsetColor" align="center"><div class="ExpenseTag">Bill</div></td>
      <td width="10%" class="offsetColor" align="center"><div class="ExpenseTag">From</div></td>
      <td width="10%" class="offsetColor" align="center"><div class="ExpenseTag">To</div></td>
    </tr>
    <tr>
      <td width="30%"><input type="text" name="rcptdate" size="10" value mysubst="50" checkdate(this.form.rcptdate)" onBlur="setProperRate(this.form.rcptdate.value,this.form)"><a HREF="javascript:doNothing()" mysubst="51" onClick="setDateField(document.forms[2].rcptdate);"><img SRC="../calendar.gif" BORDER="0" WIDTH="16" HEIGHT="16"></a></td>
      <td width="19%"><div class="ExpenseTag"></div><input type="text" name="recamt" size="8" mysubst="52" onchange="calcBarterAmount(mileage1)"><div class="ExpenseTag"></div></td>
      <td width="10%"><div class="ExpenseTag"></div><input type="text" name="xrate" size="8" mysubst="53" onchange="calcBarterAmount(mileage1)" readonly><div class="ExpenseTag"></div></td>
      <td width="10%"><div class="ExpenseTag"></div><input type="text" name="amount" value="0.00" size="8" onchange="amountVal(amount)" readonly="yes"><div class="ExpenseTag"></div></td>
      <td width="10%"><div class="ExpenseTag"></div><select name="expense_1_billtype" size="1" mysubst="54">
        <option value="Yes">Yes</option>
        <option selected value="No">No</option>
      </select><div class="ExpenseTag"></div></td>
      <td width="10%"><div class="ExpenseTag"></div><input type="text" name="xsource" size="20" mysubst="55"><div class="ExpenseTag"></div></td>
      <td width="10%"><div class="ExpenseTag"></div><input type="text" name="expense_1_comment" size="20" mysubst="56"><div class="ExpenseTag"></div></td>
    </tr>
  </form>
  <form name="mileage2">
    <input type="hidden" name="rcpttype" value="4">
    <input type="hidden" name="expense_1_expensetype" value>
    <input type="hidden" name="charge" value>
    <input type="hidden" name="units" value>
    <input type="hidden" name="expense_1_purpose" value="wizard">
    <input type="hidden" name="expense_1_xref" value>
    <tr>
      <td width="30%" class="offsetColor"><input type="text" name="rcptdate" size="10" value mysubst="57" checkdate(this.form.rcptdate)" onBlur="setProperRate(this.form.rcptdate.value,this.form)"><a HREF="javascript:doNothing()" mysubst="58" onClick="setDateField(document.forms[3].rcptdate);"><img SRC="../calendar.gif" BORDER="0" WIDTH="16" HEIGHT="16"></a></td>
      <td width="19%" class="offsetColor"><div class="ExpenseTag"></div><input type="text" name="recamt" size="8" mysubst="59" onchange="calcBarterAmount(mileage2)"><div class="ExpenseTag"></div></td>
      <td width="10%" class="offsetColor"><div class="ExpenseTag"></div><input type="text" name="xrate" size="8" mysubst="60" onchange="calcBarterAmount(mileage2)" readonly><div class="ExpenseTag"></div></td>
      <td width="10%" class="offsetColor"><div class="ExpenseTag"></div><input type="text" name="amount" value="0.00" size="8" onchange="amountVal(amount)" readonly="yes"><div class="ExpenseTag"></div></td>
      <td width="10%" class="offsetColor"><div class="ExpenseTag"></div><select name="expense_1_billtype" size="1" mysubst="61">
        <option value="Yes">Yes</option>
        <option selected value="No">No</option>
      </select><div class="ExpenseTag"></div></td>
      <td width="10%" class="offsetColor"><div class="ExpenseTag"></div><input type="text" name="xsource" size="20" mysubst="62"><div class="ExpenseTag"></div></td>
      <td width="10%" class="offsetColor"><div class="ExpenseTag"></div><input type="text" name="expense_1_comment" size="20" mysubst="63"><div class="ExpenseTag"></div></td>
    </tr>
  </form>
</table>
<p align="right">
<div class="ExpenseLink">
<a href="combine6.html#purpose">Purpose&nbsp;</a>
<a href="combine6.html#hotel">Hotel&nbsp;</a>
<a href="combine6.html#mileage">Mileage&nbsp;</a>
</div></p>
<a name="other" />
<p>
<big><div class="ExpenseTag"><em>Other Expenses</em></strong> </big></big>
</p>
<table border="0" width="100%" cellpadding="0">
  <tr class="ExpenseTag" class="offsetColor">
        <td width="150" align="center" class="offsetColor">Receipt Date</td>
        <td width="100" align="center" class="offsetColor">Amount</td>
        <td width="130" align="center" class="offsetColor">Expense Type</td>
        <td width="50" align="center" class="offsetColor">Bill</td>
        <td width="400" align="left" class="offsetColor">Comment</td>
        <td width="200" align="left" class="offsetColor">Merchant</td>
  </tr>
  <tr>
    <form name="bottom1">
        <td width="150"><input type="text" name="rcptdate" size="13" mysubst="64"><a HREF="javascript:doNothing()" mysubst="65" onClick="setDateField(document.forms[4].rcptdate);"><img SRC="../calendar.gif" BORDER="0" WIDTH="27" HEIGHT="16"></a></td>
        <td width="100"><input type="text" name="amount" size="9" value="0.00" mysubst="66"></td>
        <td width="130"><select name="expense_1_expensetype" size="1" mysubst="67">
        </select></td>
        <td width="50" height="25"><select name="expense_1_billtype" size="1" mysubst="68">
            <option value="Yes">Yes</option>
            <option selected value="No">No</option>
        </select></td>
        <td width="400"><input type="text" name="expense_1_comment" size="25" mysubst="69">
        <a href="javascript:doNothing()" mysubst="70" onClick="initAttendeeList(document.forms[4].expense_1_attendeelist,document.forms[4].expense_1_persplit,document.forms[4].expense_1_expensetype); top.newWin = window.open('../attendee2a.html', 'attendee', 'dependent=yes, width=600, height=605, screenX=580, screenY=420, titlebar=yes, menubar=no, status=no, scrollbars=yes')"><div class="ExpenseLink">Attendee List</div></a>       
        </td> 

        <td width="200">
        <select name="expense_1_merchant" size="1" tabindex="7">
        </select> <a class="ExpenseLink" href="javascript:doNothing()" tabindex="8" onClick="MerchantType = 'merchant';setLocalObj(document.forms[4].expense_1_merchant);">&nbsp;New&nbsp;Merchant</a> </td>

        <input type="hidden" name="rcpttype" value="3">
        <input type="hidden" name="expense_1_purpose" value="wizard">
        <input type="hidden" name="expense_1_xref" value>
        <input type="hidden" name="charge" value>
        <input type="hidden" name="expense_1_attendeelist" value="[]">
        <input type="hidden" name="expense_1_persplit" value>
        <input type="hidden" name="expense_1_amount" value> 
    </form>
  </tr>
  <tr>
    <form name="bottom2">
        <td width="150" class="offsetColor"><input type="text" name="rcptdate" size="13" mysubst="71"><a HREF="javascript:doNothing()" mysubst="72" onClick="setDateField(document.forms[5].rcptdate);"><img SRC="../calendar.gif" BORDER="0" WIDTH="27" HEIGHT="16"></a></td>
        <td width="100" class="offsetColor"><input type="text" name="amount" size="9" value="0.00" mysubst="73"></td>
        <td width="130" class="offsetColor"><select name="expense_1_expensetype" size="1" mysubst="74">
        </select></td>
        <td width="50" height="25" class="offsetColor"><select name="expense_1_billtype" size="1" mysubst="75">
            <option value="Yes">Yes</option>
            <option selected value="No">No</option>
        </select></td>
        <td width="400" class="offsetColor"><input type="text" name="expense_1_comment" size="25" mysubst="76">
        <a href="javascript:doNothing()" mysubst="77" onClick="initAttendeeList(document.forms[5].expense_1_attendeelist,document.forms[5].expense_1_persplit,document.forms[5].expense_1_expensetype); top.newWin = window.open('../attendee2a.html', 'attendee', 'dependent=yes, width=600, height=605, screenX=580, screenY=420, titlebar=yes, menubar=no, status=no, scrollbars=yes')"><div class="ExpenseLink">Attendee List</div></a>       
        </td>
        
        <td width="200" class="offsetColor">
        <select name="expense_1_merchant" size="1" tabindex="7">
        </select> <a class="ExpenseLink" href="javascript:doNothing()" tabindex="8" onClick="MerchantType = 'merchant';setLocalObj(document.forms[5].expense_1_merchant);">&nbsp;New&nbsp;Merchant</a> </td>

        <input type="hidden" name="rcpttype" value="3">
        <input type="hidden" name="expense_1_purpose" value="wizard">
        <input type="hidden" name="expense_1_xref" value>
        <input type="hidden" name="charge" value>
        <input type="hidden" name="expense_1_attendeelist" value="[]">
        <input type="hidden" name="expense_1_persplit" value>
        <input type="hidden" name="expense_1_amount" value> 
    </form>
  </tr>
  <tr>
    <form name="bottom3">
        <td width="150"><input type="text" name="rcptdate" size="13" mysubst="78"><a HREF="javascript:doNothing()" mysubst="79" onClick="setDateField(document.forms[6].rcptdate);"><img SRC="../calendar.gif" BORDER="0" WIDTH="27" HEIGHT="16"></a></td>
        <td width="100"><input type="text" name="amount" size="9" value="0.00" mysubst="80"></td>
        <td width="130"><select name="expense_1_expensetype" size="1" mysubst="81">
        </select></td>
        <td width="50" height="25"><select name="expense_1_billtype" size="1" mysubst="82">
            <option value="Yes">Yes</option>
            <option selected value="No">No</option>
        </select></td>
        <td width="400"><input type="text" name="expense_1_comment" size="25" mysubst="83">
        <a href="javascript:doNothing()" mysubst="84" onClick="initAttendeeList(document.forms[6].expense_1_attendeelist,document.forms[6].expense_1_persplit,document.forms[6].expense_1_expensetype); top.newWin = window.open('../attendee2a.html', 'attendee', 'dependent=yes, width=600, height=605, screenX=580, screenY=420, titlebar=yes, menubar=no, status=no, scrollbars=yes')"><div class="ExpenseLink">Attendee List</div></a>       
        </td>
        
        <td width="200">
        <select name="expense_1_merchant" size="1" tabindex="7">
        </select> <a class="ExpenseLink" href="javascript:doNothing()" tabindex="8" onClick="MerchantType = 'merchant';setLocalObj(document.forms[6].expense_1_merchant);">&nbsp;New&nbsp;Merchant</a> </td>

        <input type="hidden" name="rcpttype" value="3">
        <input type="hidden" name="expense_1_purpose" value="wizard">
        <input type="hidden" name="expense_1_xref" value>
        <input type="hidden" name="charge" value>
        <input type="hidden" name="expense_1_attendeelist" value="[]">
        <input type="hidden" name="expense_1_persplit" value>
        <input type="hidden" name="expense_1_amount" value> 
   </form>
  </tr>
  <tr>
    <form name="bottom4">
       <td width="150" class="offsetColor"><input type="text" name="rcptdate" size="13" mysubst="85"><a HREF="javascript:doNothing()" mysubst="86" onClick="setDateField(document.forms[7].rcptdate);"><img SRC="../calendar.gif" BORDER="0" WIDTH="27" HEIGHT="16"></a></td>
        <td width="100" class="offsetColor"><input type="text" name="amount" size="9" value="0.00" mysubst="87"></td>
        <td width="130" class="offsetColor"><select name="expense_1_expensetype" size="1" mysubst="88">
        </select></td>
        <td width="50" height="25" class="offsetColor"><select name="expense_1_billtype" size="1" mysubst="89">
            <option value="Yes">Yes</option>
            <option selected value="No">No</option>
        </select></td>
        <td width="400" class="offsetColor"><input type="text" name="expense_1_comment" size="25" mysubst="90">
        <a href="javascript:doNothing()" mysubst="91" onClick="initAttendeeList(document.forms[7].expense_1_attendeelist,document.forms[7].expense_1_persplit,document.forms[7].expense_1_expensetype); top.newWin = window.open('../attendee2a.html', 'attendee', 'dependent=yes, width=600, height=605, screenX=580, screenY=420, titlebar=yes, menubar=no, status=no, scrollbars=yes')"><div class="ExpenseLink">Attendee List</div></a>       
        </td>
        
        <td width="200" class="offsetColor">
        <select name="expense_1_merchant" size="1" tabindex="7">
        </select> <a class="ExpenseLink" href="javascript:doNothing()" tabindex="8" onClick="MerchantType = 'merchant';setLocalObj(document.forms[7].expense_1_merchant);">&nbsp;New&nbsp;Merchant</a> </td>

        <input type="hidden" name="rcpttype" value="3">
        <input type="hidden" name="expense_1_purpose" value="wizard">
        <input type="hidden" name="expense_1_xref" value>
        <input type="hidden" name="charge" value>
        <input type="hidden" name="expense_1_attendeelist" value="[]">
        <input type="hidden" name="expense_1_persplit" value>
        <input type="hidden" name="expense_1_amount" value> 
    </form>
  </tr>
  <tr>
    <form name="bottom5">  
        <td width="150"><input type="text" name="rcptdate" size="13" mysubst="92"><a HREF="javascript:doNothing()" mysubst="93" onClick="setDateField(document.forms[8].rcptdate);"><img SRC="../calendar.gif" BORDER="0" WIDTH="27" HEIGHT="16"></a></td>
        <td width="100"><input type="text" name="amount" size="9" value="0.00" mysubst="94"></td>
        <td width="130"><select name="expense_1_expensetype" size="1" mysubst="95">
        </select></td>
        <td width="50" height="25"><select name="expense_1_billtype" size="1" mysubst="96">
            <option value="Yes">Yes</option>
            <option selected value="No">No</option>
        </select></td>
        <td width="400"><input type="text" name="expense_1_comment" size="25" mysubst="97">
        <a href="javascript:doNothing()" mysubst="98" onClick="initAttendeeList(document.forms[8].expense_1_attendeelist,document.forms[8].expense_1_persplit,document.forms[8].expense_1_expensetype); top.newWin = window.open('../attendee2a.html', 'attendee', 'dependent=yes, width=600, height=605, screenX=580, screenY=420, titlebar=yes, menubar=no, status=no, scrollbars=yes')"><div class="ExpenseLink">Attendee List</div></a>       
        </td>
        
        <td width="200">
        <select name="expense_1_merchant" size="1" tabindex="7">
        </select> <a class="ExpenseLink" href="javascript:doNothing()" tabindex="8" onClick="MerchantType = 'merchant';setLocalObj(document.forms[8].expense_1_merchant);">&nbsp;New&nbsp;Merchant</a> </td>

        <input type="hidden" name="rcpttype" value="3">
        <input type="hidden" name="expense_1_purpose" value="wizard">
        <input type="hidden" name="expense_1_xref" value>
        <input type="hidden" name="charge" value>
        <input type="hidden" name="expense_1_attendeelist" value="[]">
        <input type="hidden" name="expense_1_persplit" value>
        <input type="hidden" name="expense_1_amount" value> 
    </form>
  </tr>
</table>
<script LANGUAGE="JavaScript" SRC="../calendar.js"></script>
<script LANGUAGE="JavaScript" SRC="../validation.js"></script>
<script LANGUAGE="JavaScript" SRC="../attendee.js"></script>
<script LANGUAGE="JavaScript" SRC="../addmerchant.js"></script>
<script language="javascript">

function FillForm() {

  document.forms[1].expenselist.subtype = "list";  //needed for Mozilla
  document.forms[1].expense_2_attendeelist.subtype = "nosave";
  document.forms[1].expense_2_persplit.subtype = "nosave";
  document.forms[1].expense_2_expdate.subtype = "nosave";
  document.forms[1].expense_2_expensetype.subtype = "nosave";
  document.forms[1].expense_2_billtype.subtype = "nosave";
  document.forms[1].expense_2_amount.subtype = "nosave";
  document.forms[1].expense_2_comment.subtype = "nosave";

  document.forms[0].xref.value = "XXX";
  parent.contents.setListWithValue(document.forms[0].clientno, parent.contents.getClientNos("1"));
  parent.contents.setListWithKey(document.forms[0].clientLookup, parent.contents.getClientNos("2"),"1","");
  //parent.contents.setClientLookup(document.forms[0].clientLookup);
  parent.contents.setListWithKey(document.forms[0].depart,parent.contents.getDeparts("1"));
  parent.contents.setListDfltWVal(document.forms[0].depart,parent.contents.getNameValue(parent.contents.Header, "depart"));
  parent.contents.setDefaultDate(document.forms[0].begdate,-1);
  parent.contents.setDefaultDate(document.forms[0].enddate,-1);
  parent.contents.setDefaultDate(document.forms[2].rcptdate,-1);
  parent.contents.setDefaultDate(document.forms[3].rcptdate,-1);
  MerchantType = "location";
  parent.contents.setListWithPers(document.forms[0].location, parent.contents.getLocations("1"),MerchantType);
  setProperRate(document.forms[2].rcptdate.value, document.forms[2]);
  document.forms[2].xrate.readOnly = parent.contents.getMileageReadOnly();
  document.forms[2].units.value = parent.contents.getDistanceLabel();
  document.forms[2].rcpttype.value = "4"
  setProperRate(document.forms[3].rcptdate.value, document.forms[3]);
  document.forms[3].xrate.readOnly = parent.contents.getMileageReadOnly();
  document.forms[3].units.value = parent.contents.getDistanceLabel();
  document.forms[3].rcpttype.value = "4"
  
  //Fills in the merchant array with the proper stuff
  MerchantType = "merchant"
  var merchArray = parent.contents.getMerchants("1");
  var mArray = merchArray.concat(parent.contents.getDBResult(parent.PersDBase,MerchantType));
  var xlist =  ";" + DedicatedList() + ";";  

  
  for (var i = 4; i < document.forms.length; i++) { 
    document.forms[i].rcpttype.value = "3"
    parent.contents.setList(document.forms[i].expense_1_expensetype, parent.contents.getExpenseTypes(parent.Category) ,parent.contents.getMerchantReq() + "LODGING;LODGNG-TAX;");
    parent.contents.setDefaultDate(document.forms[i].rcptdate,-1);
    parent.contents.setList(document.forms[i].expense_1_merchant, mArray.sort());
  }
  FillHotel();
  document.forms[0].begdate.focus();
}

function DedicatedList() {
//Remove expense types requiring other than cash.
  var retVal = "";
  var delimit = "";
  var x = parent.contents.getDedicatedMethod("1");
  for (var i = 0; i < x.length; i++) {
     if (x[i][1] != parent.contents.getChargeDef() && x[i][1] != "") {
       retVal += delimit + x[i][0];
       delimit = ";";
     }
  } 
  return retVal;
}

function FillHotel() {
    //Gets a simple list found in personal.js
    document.forms[1].charge.value = parent.contents.getChargeDef();
    //Gets a simple list found in personal.js
    parent.contents.setList(document.forms[1].expense_2_expensetype, parent.contents.getExpenseTypes(parent.Category),parent.contents.getLodgingExc() + ";");
    //Sets the number of perople default
    document.forms[1].expense_1_persplit.value = "1";
    //Sets in the default for the merchants
    MerchantType = "hotel"
    var merchArray = parent.contents.getMerchants("4");
    var mArray = merchArray.concat(parent.contents.getDBResult(parent.PersDBase,MerchantType));
    parent.contents.setList(document.forms[1].merchant, mArray.sort());
    //Sets the purpose pulldown from the HeadList
    //parent.contents.setDfltFrmHdWSplit(document.forms[1].purpose);
    //Sets the default dates (was setDefaultDate)
    parent.contents.setDefaultDate(document.forms[1].begdate1,-1);
    parent.contents.setDefaultDate(document.forms[1].begdate2,-1);
    //Sets the default dates
    parent.contents.setDefaultDate(document.forms[1].expense_2_expdate,-1);
    //Brings in any transaction information (note date above can be optimized against this later)
    //cBillLoad();
    //parent.contents.setTransaction(document.forms[1]);
    //cBillAdjust();
    resetDates();
    //document.forms[1].begdate1.focus();
}

function resetDates() {
  with (document.forms[1]) {
    if (!isDateLess(expense_2_expdate.value, begdate2.value)) expense_2_expdate.value = begdate2.value;
  }
}
function cBillLoad() {
// Take these two out if we don't need them jh 2-11-2004...    
  if (parent.contents.companyBillLoad) {
     parent.contents.companyBillLoad("trans1",document.forms[1].expense_1_billtype,document.forms[0].purpose.selectedIndex);
  }
}   

function cBillAdjust() {
  if (parent.contents.companyBillLoad) {    
   if (document.forms[1].expense_2_expensetype.selectedIndex == 0) parent.contents.companyBillLoad("trans1",document.forms[1].expense_2_billtype, document.forms[0].purpose.selectedIndex); 
  } 
} 


function calcLodging(formObj) {
        var recAmt = ChkTotal1(formObj.amount.value);
        var exp2Amt = getTotals(formObj.expenselist,"amount");

        var workNum = Math.round(100 * (recAmt - exp2Amt));

        formObj.expense_1_amount.value = workNum / 100;
        return;
}

function getTotals(yListObj, zItemName) {
  var Sum = 0;
  var x;
  for (var i = 0; i < yListObj.length; i++) {
    x = eval(yListObj.options[i].value);
    Sum = Sum + parseFloat(parent.contents.getNumericValue(x,zItemName));
  }
  return Sum;
}

function setProperRate(cDate, FF) {
   if (FF == null) FF = document.forms[0];  
   FF.xrate.value = parent.contents.getMileageDefault(cDate);
   calcBarterAmount(FF);
}


function ChkTotal1(v1) {
  if (isNaN(v1) || v1 == "") {
    return 0;
  }else{
    return Number(v1);
  }
}

var dupFlagOK = true;
function SubmitRec(nContinue) {
 if (dupFlagOK) {
  dupFlagOK = false;

  var PostScreen;

// do purpose form check here and set to false if failed
 with (document.forms[0]) {
 if (checkBillable() && CheckPurp(comment)
 && checkdate(begdate)
 && checkdate(enddate) 
 && doDateCheck(begdate.value, enddate.value) 
 && CheckMilesOK(document.forms[2]) && CheckMilesOK(document.forms[3])
 && checkdate(document.forms[2].rcptdate) && doDateChkToday(document.forms[2].rcptdate)
 && checkdate(document.forms[3].rcptdate) && doDateChkToday(document.forms[3].rcptdate)) {
    PostScreen = true;
 } else {
    PostScreen = false;
    return;
 }
 }
//Check to see if hotel s/b posted
 with (document.forms[1]) { 
 if (parseFloat(document.forms[1].amount.value) > 0) {  
    if (CheckAmount(amount)
      && doDateCheck(begdate1.value,begdate2.value)
      && doDateChkToday(begdate2)
      && CheckTotals(document.forms[1])
      && CheckAmount(expense_1_persplit)
      && CheckMerchant(merchant, parent.contents.getLodgingDef())) { 
      
      if (!isNaN(amount.value)) parent.contents.makeCurrency(amount);
      
      if (!CheckTotals(document.forms[1])) {
         alert("Hotel bill is out of balance - pls review it.");  //12/13/02
         PostScreen = false;
      }
   
    } else {
      PostScreen = false;
    }
 } 
 }

// do expense grid check here and set to false if failed
  if (PostScreen) {
    var i = 4; 
    do {
       with (document.forms[i]) { 
         if (CheckZero(amount)  
           || CheckAmount(amount) 
           && CheckExpType(expense_1_expensetype, amount) 
           && checkdate(rcptdate) 
           && doDateChkToday(rcptdate) 
           && CheckMerchant(expense_1_merchant, expense_1_expensetype.options[expense_1_expensetype.selectedIndex].text) 
           && CheckAttendee(expense_1_comment, expense_1_expensetype.options[expense_1_expensetype.selectedIndex].text)
           && CheckComment(amount, expense_1_comment, expense_1_expensetype.options[expense_1_expensetype.selectedIndex].text)) {
           i = i + 1; 
         } else {    
           PostScreen = false;
         }  
       }
    } while (PostScreen == true && i < document.forms.length);
  }

  if (PostScreen == true) {
  // post report purpose
    if (document.forms[0].xref.value == "XXX") document.forms[0].xref.value = "" + parent.contents.NextXref();
    parent.contents.UpdateReport('1','head2a',document.forms[0]);
    if (parent.contents.HeadList.length == 1) {
       var r = parent.contents.setNameValue(parent.contents.Header, "comment", document.forms[0].comment.value);     
    }
    var nvflag;
    if (document.forms[0].depart.selectedIndex > 0) {
       nvflag = parent.contents.setNameValue(parent.contents.Header, "depart", document.forms[0].depart.options[document.forms[0].depart.selectedIndex].value);
    } else {
       nvflag =  parent.contents.setNameValue(parent.contents.Header, "depart", parent.contents.getDBValue(parent.Header,"depart"));
    }
    var thisPurpose = parent.contents.getStringFmHead(parent.contents.HeadList.length - 1);
  // post the lodging
    if (parseFloat(document.forms[1].amount.value) > 0) {
      with (document.forms[1]) {
        expense_1_expdate.value = begdate2.value;
        expense_1_expensetype.value = parent.contents.getLodgingDef();    
        charge.value = parent.contents.getChargeDef();
        purpose.value = thisPurpose;
        xref.value = document.forms[0].xref.value;
        if (parent.contents.checkRemap != null) parent.contents.checkRemap(expense_1_expensetype);  
    }
      parent.contents.UpdateReport('2','trans12',document.forms[1]);
    }
  // post mileage transaction
    for (var j = 2; j < 4; j++) {
      //if ((document.forms[j].amount.value != "") && !CheckZero(document.forms[j].amount) && !isNaN(document.forms[j].recamt)) {
      if (!CheckZero(document.forms[j].amount) || !isNaN(document.forms[j].recamt)) {
            document.forms[j].expense_1_expensetype.value = parent.contents.getMileageType();
            document.forms[j].charge.value = parent.contents.getChargeDef();
            document.forms[j].expense_1_purpose.value = thisPurpose;
            document.forms[j].expense_1_xref.value = document.forms[0].xref.value;
            if (parent.contents.checkRemap != null) parent.contents.checkRemap(document.forms[j].expense_1_expensetype);  
            parent.contents.UpdateReport('2','trans5',document.forms[j]);
      }
    }
    // post expense grid transactions
    for (var j = 4; j < document.forms.length; j++) {
      //if ((document.forms[j].amount.value != "") && !CheckZero(document.forms[j].amount)) {
      if (!CheckZero(document.forms[j].amount)) {
         if (!isNaN(document.forms[j].amount.value)) parent.contents.makeCurrency(document.forms[j].amount);
         document.forms[j].charge.value = parent.contents.getChargeDef();
         document.forms[j].expense_1_purpose.value = thisPurpose;
         document.forms[j].expense_1_xref.value = document.forms[0].xref.value;
         document.forms[j].expense_1_amount.value = document.forms[j].amount.value;
         parent.contents.UpdateReport('2','trans1b',document.forms[j]);
      }
    }
    dupFlagOK = true;
    if (nContinue == 1) {
       parent.contents.TransWindow(parent.contents.defaultTrans + "multi1bx.html");
    } else if (nContinue == 2) {
       parent.contents.TransWindow(parent.contents.defaultHead + "combine6ay.html");
    } else {
       parent.contents.ListDelay();
    }
//  } else {
//    dupFlag = true;
  }
 } 
 dupFlagOK = true;
}


function AddExpArray(xArray,xAmount,xExpensetype,xExpdate,xComment,xBilltype,xPersplit,xAttendeelist) {
  var x = new Array();
  x = Add2ExpArr(x,"amount",xAmount.value);
  x = Add2ExpArr(x,"expensetype",xExpensetype.options[xExpensetype.selectedIndex].text);
  x = Add2ExpArr(x,"expdate",xExpdate.value);
  x = Add2ExpArr(x,"comment",xComment.value);
  x = Add2ExpArr(x,"billtype",xBilltype.options[xBilltype.selectedIndex].text);
  x = Add2ExpArr(x,"persplit",xPersplit.value);
  x = Add2ExpArr(x,"attendeelist",eval(xAttendeelist.value));
//alert("xAttendeelist = " + xAttendeelist.value);  
  if (x.length > 0) {
    var a = xArray.length;
    xArray.length = a + 1;
    xArray[a] = ["expense",x]
  }
  return xArray;
}

function Add2ExpArr(x,y,z) {
  if (z != null && z != "" && z != "[]") {
    a = x.length;
    x.length = a + 1;
    x[a] = parent.contents.TransCell(y,z);
  }
  return x;
}

function CheckMilesOK(xx) {
  var retval = true;
  if ((xx.amount.value != "") && !CheckZero(xx.amount)) {
   if ( xx.xsource.value.length < 1) {
     retval = false;
     alert("'From' field not filled out correctly");
     xx.xsource.focus();
   } else if (xx.expense_1_comment.value.length < 1) {
     retval = false;
     alert("'To' field not filled out correctly");
     xx.expense_1_comment.focus();
   } else if (isNaN(xx.recamt.value)) {
     retval = false;
     alert(parent.contents.getDistanceLabel() + " field not a valid number");
     xx.recamt.focus();
   }
  }
  return retval;
}

function checkBillable() {
  var retVal = true;
  with (document.forms[0]) {
  var cln = clientno.selectedIndex;
  if (billtype.options[billtype.selectedIndex].text == "Yes" && cln == 0) {
      alert("Must specifiy client number if billable is 'Yes'");
      billtype.focus();
      return false;
  }
  var billValue = billtype.options[billtype.selectedIndex].text;
  } 

  if (!cCheckBill()) {
      retVal = false;
  } else {

    for (var j = 2; j < document.forms.length; j++) {
      with (document.forms[j]) {
      if (billValue == "No" && expense_1_billtype.options[expense_1_billtype.selectedIndex].text == "Yes") {
        alert("Cannot bill an item - Client billable specified in purpose is set to 'No'");
        expense_1_billtype.focus();
        retVal = false;
      }
      }
    } 
  }
  return retVal;
}

function cCheckBill() {
  var retval = true;
  with (document.forms[0]) {
    var billValue = billtype.options[billtype.selectedIndex].text;
  }
  return retval;
}

function cBCheck(BillList,PurposeBill) {
  var BillValue = BillList.options[BillList.selectedIndex].text;
  if (PurposeBill == "No" && BillValue == "Yes") {
     alert("Cannot bill an item - Client billable specified in purpose is set to 'No'");
     BillList.focus();
     return true; //cannot bill this item
  } else {
     return false;
  }
}

function CheckAttendee(tag,expense) {
  var retVal = true;
  if (expense.length > 0) {
    var Check = tag.value;
    var Xstr = parent.contents.getAttendeeReq();
    if (Xstr.indexOf(";" + expense + ";") > -1 && Check.length < 3) {
      alert("Need to supply attendee list for " + expense + " expense");
      tag.focus();
      retVal = false;
    }
  }
  return retVal;
}

function CheckMerchant(tag,expense) {
  return CheckRequired(tag,expense,parent.contents.getMerchantReq(),"Need to supply a hotel name");
}

function CheckRequired(tag,expense,validation, msgtext) {
  var Check = "";
  var n = false 
  var CmtLen = parent.contents.getCommentLen();
  expense = ";" + expense + ";";
  if (expense != "" && validation.indexOf(expense) > -1) {
    if (tag.type.indexOf("select") == 0) {
      Check = tag.options[tag.selectedIndex].text;
      if (Check.length > 2) n = true;     
    } else { 
      Check = parent.contents.alltrim(tag.value);
      if (Check.length >= CmtLen) n = true;
    } 
    if (!n) {
      alert(msgtext);
      tag.focus();
      return false;
    } else {
      return true;
    }
  } else {
     return true;
  }
}

function CheckExpType(tag1, tag2) {
        if (!CheckZero(tag2) && (tag1.selectedIndex == 0)) {
     alert("Select an Expense Type.");
     tag1.focus();
     return false;
  } else {
     return true;
  }
}
function CheckPurp(obj) {
  var Check = parent.contents.alltrim(obj.value);
  if (Check.length > 9) {
          return true;
  } else {
          alert("Need to supply a Purpose or Individuals of at least 10 characters.");
          obj.focus();
          obj.select();
          return false;
  }
}
function CheckZero(tag) {
  var Check = parseFloat(tag.value);
  if (Check == 0) {
     return true;
  } else {
     return false;
  }
}

function CheckAmount(tag) {
  return parent.contents.checkAmtFldOK(tag);
}

function ChkExtra1(o1,o2,o3,o4) {
  if (isNaN(o1.value) || parent.contents.rtrim(o1.value) == "" || o1.value == 0) {
    o1.value = "";
    o2.selectedIndex = 0;
    o3.value = "";
    o4.value = "";
    return false;
  } else {
    return true;
  }
}
// eventually combine these 2 functions 12/13/02
function ChkExtra2(o1,o2,o3,o4,o5) {
  if (o1.selectedIndex == 0 || isNaN(o2.value) || parent.contents.rtrim(o2.value) == "" || o2.value == 0) {
    o2.value = "";
    o3.length = 3;
    o3.options[2].text = "";
    o3.options[2].value = "";
    o3.selectedIndex = 2;
    if (o4 != null) o4.value = "";
    if (o5 != null) o5.value = "";
  }
}

function CheckTotals(formObj) {
   if (formObj == null) formObj = document.forms[0];
   var recAmt = ChkTotal1(formObj.amount.value);
   var exp1Amt = ChkTotal1(formObj.expense_1_amount.value);
   var exp2Amt = getTotals(formObj.expenselist,"amount");
   var expAmt = exp1Amt + exp2Amt;
   if (recAmt - expAmt < 0.005 && expAmt - recAmt < 0.005) {
     if (exp1Amt > 0) {
        return true;
     } else {
        alert("Room amount must be greater than zero")
        return false;
     }
   } else {
     alert("Receipt is out of balance by " + (recAmt - (exp1Amt + exp2Amt)));
     return false;
   } 
}

function ChkTotal1(v1) {
  if (isNaN(v1) || v1 == "") {
    return 0;
  }else{
    return Number(v1);
  }
}


function ChkBtween(xType,rdateObj) {

  if (xType.selectedIndex != 0) {
    if (doBetweenChk(rdateObj.value,document.forms[1].begdate1.value,document.forms[1].begdate2.value)) {
      return true;
    } else {
      rdateObj.focus();
      return false;
    } 
  } else {
    return true;
  }
}

var NeedComment = parent.contents.getCommentReq();
function CheckComment(val,tag,expensetype) {
  var Check = tag.value;
  expensetype = ";" + expensetype + ";";
  if (!CheckZero(val) && expensetype.length > 2 && NeedComment.indexOf(expensetype) > -1 && Check.length < 10) {
     alert("Need to supply a comment of at least 10 characters");
     tag.focus();
     return false;
  } else {
     return true;
  }
}
function CkCt(val,tag,expObj) {
  return CheckComment(val,tag,expObj[expObj.selectedIndex].text);
}

function calcBarterAmount(formObj) {
        var barterItem = formObj.recamt.value;
        if (barterItem == "") barterItem = "0.00";
        var intAmount = parseFloat(barterItem);
        var intRate = parseFloat(formObj.xrate.value);
        var totalAmt = intAmount * intRate;
        formObj.amount.value = totalAmt;
        amountVal(formObj.amount);
        //formObj.amount.value = amountVal(formObj.amount);
        return;
}

function updDefaultDate(formObj) {
       document.forms[1].rcptdate.value = formObj.value;
       for (var j = 2; j < document.forms.length; j++) {
               document.forms[j].rcptdate.value = formObj.value;
       }
}

function resetBillType() {
   for (var j = 1; j < document.forms.length; j++) {
     document.forms[j].expense_1_billtype.selectedIndex = document.forms[0].billtype.selectedIndex;
   }
   document.forms[1].expense_2_billtype.selectedIndex = document.forms[0].billtype.selectedIndex;
}

function populateClientLoc() { 
  if (document.forms[0].clientno.selectedIndex == 0) {
    document.forms[0].client.readOnly = false;
    document.forms[0].billtype.selectedIndex = 1;
  } else {
    document.forms[0].client.value = document.forms[0].clientno.options[document.forms[0].clientno.selectedIndex].value;
    document.forms[0].client.readOnly = true;
    document.forms[0].billtype.selectedIndex = 0;
  }
  resetBillType();
}             

function populateClientNo() {
  with (document.forms[0]) {
    if (clientLookup.selectedIndex > 0) {  
      parent.contents.setListDefault(clientno, clientLookup.options[clientLookup.selectedIndex].value);
      populateClientLoc();
    }
  }
}

function LookupCleanup() {
  document.forms[0].clientLookup.selectedIndex = 0;
}

function resetDate() {
  // Review this to see how it works later....
  //document.forms[0].enddate.value = document.forms[0].begdate.value;
  for (var i = 1; i < document.forms.length; i++) { 
    document.forms[i].rcptdate.value = document.forms[0].begdate.value;
  }
  setProperRate(document.forms[2].rcptdate.value, document.forms[2]);
  setProperRate(document.forms[3].rcptdate.value, document.forms[3]);
  var x = parseFloat(document.forms[1].amount.value)
  if (!isNaN(x) && x == 0) {
     document.forms[1].begdate1.value = document.forms[0].begdate.value;
     document.forms[1].expense_2_expdate.value = document.forms[0].begdate.value;
  }
}

function popDates() {
  with (document.forms[1]) {    
    if (checkdate(begdate1)) {
      if (!isDateLess(begdate1.value, begdate2.value)) {
        begdate2.value = begdate1.value;
      } 
      expense_2_expdate.value = begdate1.value
    }
  }
}

function endHotelDate() { 
  var x = parseFloat(document.forms[1].amount.value)
  if (!isNaN(x) && x == 0) {
     document.forms[1].begdate2.value = document.forms[0].enddate.value;
  }
}

//=========
function doubleChk(x) {
  if (checkdate(x)) resetDates();
}

function loadExpense() {
  with (document.forms[1]) {  
   if (expenselist.selectedIndex > -1) {
     blankExpense();
     var dBase = eval(expenselist.options[expenselist.selectedIndex].value);
     dBase1 = dBase[1];
     expense_2_expdate.value = parent.contents.getDBValue(dBase1, "expdate");
     parent.contents.setListDefault(expense_2_expensetype,parent.contents.getDBValue(dBase1, "expensetype"));
     expense_2_amount.value = parent.contents.getDBValue(dBase1, "amount");
     //expense_2_recamt.value = parent.contents.getDBValue(dBase1, "recamt");
     //parent.contents.setListDfltWVal(expense_1_purpose, parent.contents.getDBValue(dBase1, "purpose"));  //won't work
     expense_2_comment.value = parent.contents.getDBValue(dBase1, "comment");
     var x = parent.contents.getDBString(dBase1, "attendeelist",[])
     if (typeof(x) == "string") {
       expense_2_attendeelist.value = x; 
     } else {   
       expense_2_attendeelist.value = parent.contents.setArray2Str(x);
     }
     parent.contents.setListDefault(expense_2_billtype,parent.contents.getDBSingle(dBase1, "billtype"));
     expense_2_persplit.value = parent.contents.getDBValue(dBase1, "persplit");
   }
  }
}

function newExpense() {
  with (document.forms[1]) {  
   if (expenselist.selectedIndex > -1) {
     blankExpense();
     expenselist.selectedIndex = -1;
   }
  }
}

function blankExpense() {
 with (document.forms[1]) {
   //expense_2_expdate.value = begdate1.value; 
   expense_2_expensetype.selectedIndex = 0;
   expense_2_amount.value = "";
   //expense_2_recamt.value = "";
   //expense_2_purpose.selectedIndex = expense_2_purpose.length - 1; 
   expense_2_comment.value = "";
   expense_2_attendeelist.value = "[]";
   expense_2_billtype.selectedIndex = 1;
   expense_2_persplit.value = "1";
 }
}


function removeExpense() {
  with (document.forms[1]) {  
    if (expenselist.selectedIndex > -1) {
      var y = expenselist.length;
      for (var i = expenselist.selectedIndex; i < y - 1; i++) { 
        expenselist.options[i].text = expenselist.options[i + 1].text;
        expenselist.options[i].value = expenselist.options[i + 1].value;
      }
      expenselist.length = y - 1;
      newExpense();
      calcLodging(document.forms[1]);
      //****CheckAmountAndDisburse(amount,expenselist,"amount",expense_1_disburse);
    }
  }
}

function addExpense() {
 with (document.forms[1]) { 
  if (CheckAmount(expense_2_amount)
      && CheckExpType(expense_2_expensetype,expense_2_amount)
      && checkdate(expense_2_expdate)
      && CheckAttendee(expense_2_attendeelist, expense_2_expensetype.options[expense_2_expensetype.selectedIndex].text)
      && ChkBtween(expense_2_expensetype,expense_2_expdate)
      && CheckComment(expense_2_comment.value, expense_2_comment, expense_2_expensetype.options[expense_2_expensetype.selectedIndex].text)) {
     
    if (ChkExtra1(expense_2_amount,expense_2_expensetype,expense_2_expdate,expense_2_comment)) parent.contents.makeCurrency(expense_2_amount);
    ChkExtra2(expense_2_expensetype,expense_2_amount,expense_2_billtype,expense_2_persplit,expense_2_attendeelist);
      
    var dBase
    var dBase1
 
    if (expenselist.selectedIndex == -1) {
        dBase = ["expense",[]]
    } else {
        dBase = eval(expenselist.options[expenselist.selectedIndex].value);
    }

    dBase1 = dBase[1];
    //if (!isNaN(recamt.value)) parent.contents.makeCurrency(expense_2_recamt);
    parent.contents.makeCurrency(expense_2_amount);
    parent.contents.setDBPair(dBase1, "expdate",expense_2_expdate.value);
    parent.contents.setDBPair(dBase1,"expensetype",expense_2_expensetype.options[expense_2_expensetype.selectedIndex].text);
    parent.contents.setDBPair(dBase1, "amount",expense_2_amount.value);
    //parent.contents.setDBPair(dBase1, "recamt",expense_2_recamt.value);
    //parent.contents.setDBPair(dBase1,"purpose",expense_2_purpose.options[expense_2_purpose.selectedIndex].value);
    parent.contents.setDBPair(dBase1, "comment",expense_2_comment.value);
    if (expense_2_attendeelist.value == null) alert("attendeelist error\ncontact support");//expense_2_attendeelist.value = "[]";
    parent.contents.setDBPair(dBase1, "attendeelist",eval(expense_2_attendeelist.value));
    parent.contents.setDBPair(dBase1,"billtype",expense_2_billtype.options[expense_2_billtype.selectedIndex].value);
    parent.contents.setDBPair(dBase1,"persplit",expense_2_persplit.value);

    dBase[1] = dBase1;
    if (expenselist.selectedIndex == -1) {
      var j = expenselist.length;
      expenselist.length = j + 1;
      expenselist.selectedIndex = j;
    } 
    expenselist.options[expenselist.selectedIndex].value = parent.contents.setArray2Str(dBase);
    var DD = "";
    var xStr = "";
    var x = parent.contents.getListDisplay("expenselist")
    for (var i = 0; i < x.length; i++) {
      xStr += DD + parent.contents.getNameValue(dBase1,x[i]);
      DD = ": ";
    }
    expenselist.options[expenselist.selectedIndex].text = xStr;
    
    calcLodging(document.forms[1]);
    
    newExpense();

  }
 } 

}




</script>

<table border="0" cellpadding="0" cellspacing="0" width="100%">
  <tr>
    <td width="50%"><p align="right"><input type="button" value=" Click to add another purpose" name=" " onClick="Javascript: void SubmitRec(2)" mysubst="99" onDblClick="dupFlagOK = false"></p></td>
    <td width="50%"><p align="left"><input type="button" value=" Click to add another expense" name=" " onClick="Javascript: void SubmitRec(1)" mysubst="100" onDblClick="dupFlagOK = false"></p></td>
  </tr>
</table>
<p align="center"><input type="button" value=" Finish Wizard and return to report display" name=" " mysubst="101" onClick="Javascript: void SubmitRec(0)" onDblClick="dupFlagOK = false"></p>

</body>
</html>
